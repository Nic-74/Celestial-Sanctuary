:root {
    /* Theme variables are now set exclusively by the blocking script in index.html */
    /* This prevents a Flash of Unstyled Content (FOUC) */

    /* Fonts */
    --font-body: 'Philosopher', serif;
    --font-display: 'Cinzel Decorative', serif;
    --font-handwriting: 'Dancing Script', cursive;
    --font-chinese: 'Noto Serif SC', serif;

    /* Transitions */
    --transition-fast: all 0.25s cubic-bezier(0.645, 0.045, 0.355, 1);
    --transition-slow: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.creepster-regular {
  font-family: "Creepster", system-ui;
  font-weight: 400;
  font-style: normal;
}

/* Added a creepy font for the failure screen */
@font-face {
  font-family: 'CreepyFont';
  src: url('https://fonts.gstatic.com/s/creepster/v23/AlZy_zVUqJz4yMrniH4hdXJe.woff2') format('woff2');
  font-weight: normal;
  font-style: normal;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }

body {
    font-family: var(--font-body);
    background-color: var(--space-black);
    color: var(--text-primary);
    /* allow page scrolling so long pages (solar system, panels) can reach the end */
    overflow: auto;
}

hr {
    border: none;
    height: 1px;
    background-image: linear-gradient(to right, transparent, var(--gold), transparent);
    margin: 2rem 0;
    box-shadow: 0 0 10px var(--gold);
}

/* --- HIDE SCROLLBARS --- */
/* For Chrome, Safari, and Opera */
*::-webkit-scrollbar { display: none; }
/* For IE, Edge, and Firefox */
* { -ms-overflow-style: none; scrollbar-width: none; }

/* ANIMATIONS */
@keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
@keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes pulse-glow { 0%, 100% { filter: drop-shadow(0 0 8px var(--gold)); } 50% { filter: drop-shadow(0 0 20px var(--soft-violet)); } }
@keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
@keyframes drift { 0% { transform: translate(0, 0) rotate(0deg); } 25% { transform: translate(2px, 4px) rotate(-1deg); } 50% { transform: translate(-2px, -2px) rotate(1deg); } 75% { transform: translate(3px, -3px) rotate(-0.5deg); } 100% { transform: translate(0, 0) rotate(0deg); } }
@keyframes float-up { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-200px) scale(0); opacity: 0; } }
@keyframes star-pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 10px 2px var(--gold); } 50% { transform: scale(1.2); box-shadow: 0 0 20px 5px var(--soft-violet); } }
@keyframes core-pulse-animation { 0% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.1); opacity: 0.3; } 100% { transform: scale(1); opacity: 0.6; } }

/* BACKGROUND */
.background-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(ellipse at 50% 50%, #1a2a45 0%, #0d152b 50%, #02041b 100%); }
.background-container {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    /* Use a CSS variable for the background, set by the blocking script */
    background: var(--theme-bg-gradient);
}
.stars-bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
    opacity: 0.5;
    z-index: 0;
}
.chinese-pattern {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect x="0" y="0" width="100" height="100" fill="none"/><path d="M 50 0 L 100 50 L 50 100 L 0 50 Z" fill="none" stroke="%23ffd70020" stroke-width="1"/><path d="M 25 0 L 50 25 L 25 50 L 0 25 Z" fill="none" stroke="%23ffd70010" stroke-width="0.5"/><path d="M 75 0 L 100 25 L 75 50 L 50 25 Z" fill="none" stroke="%23ffd70010" stroke-width="0.5"/><path d="M 25 50 L 50 75 L 25 100 L 0 75 Z" fill="none" stroke="%23ffd70010" stroke-width="0.5"/><path d="M 75 50 L 100 75 L 75 100 L 50 75 Z" fill="none" stroke="%23ffd70010" stroke-width="0.5"/></svg>');
    opacity: 0.1;
    pointer-events: none;
    display: block;
    z-index: 0;
}
#web-canvas-landing, #web-canvas-main {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1; /* Above stars/patterns, below particles */
    transition: opacity 0.5s ease-in-out;
}
#particles-canvas, #landing-particles-canvas { 
    position: absolute; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    pointer-events: none; 
    opacity: 0.8; 
    z-index: 2; /* Ensure particles are on top of the web */
    transition: opacity 0.5s ease-in-out;
}

/* Spiral canvas overlay (particle-based) */
#spiral-canvas-main, #spiral-canvas-landing {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 4; /* above particles canvas and css spiral */
    mix-blend-mode: screen;
    opacity: 0.95;
}

@media (prefers-reduced-motion: reduce) {
    #spiral-canvas-main, #spiral-canvas-landing { display: none; }
}

@media (prefers-reduced-motion: reduce) {
    #spiral-canvas-main, #spiral-canvas-landing { display: none; }
}

/* MAIN LAYOUT */
#celestial-sanctuary { width: 100%; min-height: 100vh; position: relative; overflow: visible; }

/* LANDING GATE STYLES */
#landing-gate {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: var(--space-black); /* Set a base background color */
    cursor: pointer;
    overflow-y: auto; /* Allows the whole page to scroll if content is tall */
}
.gate-container {
    /* Flex properties removed to allow top-alignment */
    text-align: center;
    padding: 8vh 2rem; /* Use vertical padding to create space from the top */
    animation: fade-in 1.5s ease-out forwards;
    width: 100%;
    min-height: 100%; /* Ensures it fills at least the viewport */
}
.gate-content {
    max-width: 800px;
    margin: 0 auto; /* Horizontally centers the content block */
}
#landing-gate .main-title {
    font-family: var(--font-display);
    font-size: clamp(3em, 8vw, 6em);
    color: var(--gold);
    text-shadow: 0 0 20px var(--gold), 0 0 30px var(--soft-violet);
    letter-spacing: 5px;
    margin-bottom: 1rem;
}
#landing-gate .subtitle {
    font-family: var(--font-display);
    font-size: clamp(1.2em, 3vw, 2em);
    color: var(--text-primary);
    margin-bottom: 2rem;
    text-shadow: 0 0 10px var(--gold);
}
#landing-gate .description {
    font-size: clamp(1em, 2vw, 1.2em);
    color: var(--gold-light);
    line-height: 1.8;
    margin-bottom: 2rem;
    font-style: italic;
}
#landing-gate .countries {
    font-family: var(--font-body);
    font-size: 1.2em;
    color: var(--text-secondary);
    margin-bottom: 3rem;
    letter-spacing: 2px;
}
.heart-icon {
    color: #dc143c;
    font-size: 1.2em;
    margin: 0 10px;
    text-shadow: 0 0 8px #dc143c;
}
#landing-gate .prophecy {
    font-family: var(--font-display);
    font-size: clamp(1.1em, 2.5vw, 1.4em);
    color: var(--gold-light);
    line-height: 1.8;
    text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
    text-transform: uppercase;
    letter-spacing: 1px;
}
#landing-gate .prompt {
    margin-top: 4rem;
    font-size: 1rem;
    color: var(--text-secondary);
    animation: pulse-glow 2.5s infinite;
}


/* MAIN MENU DROPDOWN */
#main-menu-container {
    position: fixed;
    top: 70px; /* Position below the 50px mood bar + 20px margin */
    left: 20px;
    z-index: 2000;
}
#main-menu-button {
    width: 110px;
    height: 110px;
    background: radial-gradient(circle, var(--gold), var(--soft-violet));
    border: 1px solid var(--gold);
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 15px var(--soft-violet), inset 0 0 10px rgba(255,255,255,0.4);
    transition: var(--transition-fast);
    animation: float 4s ease-in-out infinite;
    padding: 8px; /* Add padding to create a border effect */
}
/* --- MODIFIED RULE FOR THE DRAGGING STATE --- */
#main-menu-container.dragging {
    animation: none; /* Pause the float animation while dragging */
    cursor: grabbing;
}
/* --- ADD THESE NEW RULES FOR LONG PRESS FEEDBACK --- */
#main-menu-container.ready-to-drag {
    animation: none; /* Pause float animation */
    cursor: grab;
}
/* --- ENHANCED: Make "Ready to move" text spatially aware --- */
#main-menu-container.ready-to-drag::after {
    content: 'Ready to move';
    position: absolute;
    left: 50%;
    background: var(--gold);
    color: var(--deep-purple);
    font-weight: bold;
    padding: 8px 15px;
    border-radius: 6px;
    font-size: 1rem;
    white-space: nowrap;
    box-shadow: 0 0 10px var(--gold), 0 0 20px var(--soft-violet);
    z-index: 2001; /* Ensure it's on top */

    /* Default to bottom, but allow override */
    bottom: -40px; 
    transform: translateX(-50%);
    /* If the button is at the bottom, show the tooltip on top */
    top: var(--tooltip-top, auto);
    bottom: var(--tooltip-bottom, -40px);
}
/* --- ADD THIS NEW RULE FOR THE FAVICON IMAGE --- */
#main-menu-button img {
    width: 90%; /* Make the icon slightly smaller than the button */
    height: 90%;
    object-fit: cover; /* This ensures the image fills the space */
    border-radius: 50%;
}
#main-menu-button:hover {
    transform: scale(1.1);
    box-shadow: 0 0 25px var(--gold), 0 0 40px var(--soft-violet), inset 0 0 10px rgba(255,255,255,0.4);
    animation-play-state: paused;
}
#main-menu-dropdown {
    position: absolute;
    background: var(--holoscreen-bg);
    border: 1px solid var(--border-glass);
    backdrop-filter: blur(12px);
    border-radius: 8px; 
    width: 220px;
    padding: 10px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px) scale(0.95);
    transform-origin: top; /* Animate from the top edge by default */
    transition: var(--transition-fast);
    box-shadow: 0 10px 30px var(--shadow-color);
    max-height: 80vh; /* Set a max height (80% of viewport height) */
    overflow-y: auto; /* Enable vertical scrolling when content exceeds max-height */
}
/* --- ADD THIS: Adjust animation for opening upwards --- */
#main-menu-dropdown.opens-up {
    transform: translateY(10px) scale(0.95);
    transform-origin: bottom; /* Animate from the bottom edge */
}
#main-menu-dropdown.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}
/* --- ADD THIS: Helper class for JS to measure dimensions off-screen --- */
.main-menu-dropdown.measuring {
    visibility: hidden;
    position: absolute;
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}
#main-menu-dropdown a {
    display: block;
    padding: 12px 15px;
    color: var(--gold-light);
    text-decoration: none;
    font-family: var(--font-body);
    border-radius: 4px;
    transition: var(--transition-fast);
    font-size: 1.1rem;
}
#main-menu-dropdown a:hover {
    background: rgba(255, 215, 0, 0.1);
    color: var(--gold);
    transform: translateX(5px);
}
#main-menu-dropdown hr {
    margin: 0.5rem 0;
    box-shadow: none;
    background-image: linear-gradient(to right, transparent, var(--border-glass), transparent);
}
/* --- ADD THIS NEW RULE BLOCK FOR THE SCROLLBAR --- */
#main-menu-dropdown::-webkit-scrollbar {
    width: 8px;
}

#main-menu-dropdown::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

#main-menu-dropdown::-webkit-scrollbar-thumb {
    background: var(--gold);
    border-radius: 4px;
}

#main-menu-dropdown::-webkit-scrollbar-thumb:hover {
    background: var(--gold-light);
}

/* SOLAR SYSTEM NAVIGATION */
#solar-system-container {
    position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
    transition: var(--transition-slow); opacity: 1; z-index: 10;
    pointer-events: none;
}
#solar-system-container.hidden { opacity: 0; pointer-events: none; transform: scale(0.8); }
.orbit {
    position: absolute; border: 1px dashed rgba(255, 215, 0, 0.3); border-radius: 50%;
    animation-name: spin; animation-timing-function: linear; animation-iteration-count: infinite;
    pointer-events: none;
}
.planet {
    position: absolute; border-radius: 50%; cursor: pointer; transition: var(--transition-fast);
    box-shadow: inset 0 0 15px rgba(0,0,0,0.4), 0 0 5px rgba(255,255,255,0.1);
    top: 50%; left: 0; transform: translate(-50%, -50%); z-index: 11; pointer-events: all;
}
.planet:hover {
    transform: translate(-50%, -50%) scale(1.2);
    box-shadow: inset 0 0 10px rgba(0,0,0,0.2), 0 0 25px var(--gold), 0 0 40px var(--soft-violet);
    z-index: 12;
}
.planet-name-display {
    position: fixed; top: 50%; left: calc(50% + 49vmin); transform: translateY(-50%);
    background: var(--holoscreen-bg); padding: 8px 15px; border-radius: 4px; border-left: 3px solid var(--gold);
    font-family: var(--font-display); font-size: 1.1rem; color: var(--gold-light);
    opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
    white-space: nowrap; z-index: 5000; pointer-events: none;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}
.planet-name-display.visible { opacity: 1; visibility: visible; }

/* UNIFIED CONTENT AREA (NO PANELS) */
.main-content { 
    background-color: transparent;
    backdrop-filter: none;
    border: none; 
    box-shadow: none;
    color: var(--text-primary); 
    overflow-y: auto; 
    position: absolute; inset: 0; z-index: 20;
    opacity: 0; visibility: hidden; transform: translateY(20px);
    transition: var(--transition-slow);
    padding: 100px 7vw 50px 7vw;
}
.main-content.visible { opacity: 1; visibility: visible; transform: translateY(0); }

/* MUSIC PLAYER */
#music-player-sun {
    position: relative; width: 18vmin; height: 18vmin;
    min-width: 120px; min-height: 120px; z-index: 100; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    pointer-events: all;
}
.sun-surface {
    width: 100%; height: 100%; border-radius: 50%;
    background: radial-gradient(circle, var(--gold), var(--crimson));
    box-shadow: 0 0 40px var(--gold), 0 0 80px var(--crimson), inset 0 0 30px rgba(255,255,255,0.5);
    animation: spin 60s linear infinite, pulse-glow 5s ease-in-out infinite;
    display: flex; align-items: center; justify-content: center; overflow: hidden;
    transition: var(--transition-fast);
}

#sun-album-art { width: 95%; height: 95%; object-fit: cover; border-radius: 50%; transition: opacity 0.5s ease-in-out; position: relative; z-index: 2;}

/* PLAYER REDESIGN: Circular player panel with better content containment */
#music-player-panel {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 380px;
    height: 380px;
    background: var(--holoscreen-bg);
    border: 1px solid var(--border-glass);
    backdrop-filter: blur(12px);
    border-radius: 50%;
    opacity: 0;
    visibility: hidden;
    transform: translate(-50%, -50%) scale(0.5);
    transition: var(--transition-slow);
    cursor: default;
    overflow: visible; /* Changed from hidden to visible */
    z-index: 101;
    display: flex;
    flex-direction: column;
}
#music-player-sun.expanded #music-player-panel { opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1); }
#music-player-sun.expanded .sun-surface { opacity: 0; transform: scale(0.5); pointer-events: none; }

.player-view { 
    display: none; 
    flex: 1;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
}
.player-view.active { display: flex; }

#player-view-now-playing { 
    display: none; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center;
    padding: 2rem 1.5rem 3.5rem 1.5rem; /* Added bottom padding for tabs */
    box-sizing: border-box;
}
#player-view-now-playing.active { display: flex; }

#panel-album-art { 
    width: 90px;
    height: 90px;
    border-radius: 8px; 
    object-fit: cover; 
    margin-bottom: 0.8rem;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
}
#song-info { text-align: center; margin-bottom: 0.8rem; width: 100%; }
#song-title { font-size: 1.1rem; color: var(--gold); margin-bottom: 0.3rem; }
#song-artist { font-size: 0.9rem; color: var(--text-secondary); }
#time-container { display: flex; justify-content: space-between; font-size: 0.75rem; margin-top: 0.3rem; width: 100%; color: var(--text-secondary); }
#progress-bar-container { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; cursor: pointer; margin-bottom: 0.5rem; }
#progress-bar { height: 100%; width: 0%; background: var(--gold); border-radius: 3px; }
#music-controls { display: flex; justify-content: space-around; align-items: center; margin: 0.8rem 0; width: 100%;}
.control-btn { background: none; border: none; color: var(--gold); font-size: 1.4rem; cursor: pointer; transition: var(--transition-fast); }
.control-btn:hover { color: var(--soft-violet); transform: scale(1.1); }
#shuffle-btn.active { color: var(--soft-violet); }
#volume-container { display: flex; align-items: center; gap: 0.5rem; justify-content: center; width: 100%; margin-top: 0.5rem;}
#volume-slider { width: 100px; }

/* Playlist view with proper containment */
#player-view-playlist { 
    padding: 2rem 1.5rem 3.5rem 1.5rem; /* Added bottom padding for tabs */
    flex-direction: column; 
    box-sizing: border-box;
}
#player-view-playlist h4 {
    font-size: 1.1rem;
    margin-bottom: 0.8rem;
    text-align: center;
    font-family: var(--font-display);
    flex-shrink: 0;
    color: var(--gold);
}
#player-view-playlist > div:nth-child(2) {
    padding: 0 1rem 1rem 1rem;
    text-align: center;
    flex-shrink: 0;
}
#player-view-playlist > div:nth-child(2) .btn {
    width: auto; /* Let the button size to its content */
    padding-left: 2rem; /* Add some horizontal padding for aesthetics */
    padding-right: 2rem;
}
#playlist { 
    max-height: 160px;
    overflow-y: auto; 
    flex-grow: 1;
    padding-right: 5px;
}
.playlist-item { 
    padding: 0.7rem; 
    border-radius: 4px; 
    cursor: pointer; 
    transition: var(--transition-fast); 
    font-size: 0.85rem; 
    color: var(--text-primary); 
    border-bottom: 1px solid var(--border-glass); 
}
.playlist-item:hover { background: rgba(255, 215, 0, 0.05); }
.playlist-item.active { background: rgba(255, 215, 0, 0.1); color: var(--gold); }

/* UPDATED Player Tabs Styles */
.player-tabs {
    position: absolute;
    bottom: 15px; /* Raised from the bottom edge */
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 25px; /* Pill shape */
    overflow: hidden;
    z-index: 11; /* Make sure it's on top */
    border: 1px solid var(--border-glass);
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}
.player-tab-btn {
    flex: 1;
    background: none;
    border: none;
    color: var(--text-secondary);
    padding: 0.6rem 1.2rem; /* Adjusted padding */
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 1.2rem; /* Bigger for emojis */
    line-height: 1; /* For better vertical centering */
}
.player-tab-btn.active {
    color: var(--gold);
    background: rgba(255, 215, 0, 0.2);
}
.player-tab-btn:hover:not(.active) {
    color: var(--gold-light);
    background: rgba(255, 255, 255, 0.1);
}

/* GENERAL CONTENT STYLING */
.content-panel.active { animation: fade-in-up 0.6s; }
.content-panel:not(#nebula-of-solitude) {
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}
.panel-header {
    font-family: var(--font-display);
    font-size: 2.8rem;
    margin-bottom: 0.5rem;
    color: var(--gold);
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
    text-align: center;
}
.panel-subheader { 
    color: var(--text-secondary); 
    margin-bottom: 2rem; 
    max-width: 600px; 
    font-style: italic; 
    line-height: 1.6; 
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}
.section-title { text-align: center; font-family: var(--font-display); font-size: 2.5em; color: var(--gold); margin: 20px 0 40px 0; text-shadow: 0 0 10px var(--gold), 0 0 15px var(--soft-violet); }

/* UI ELEMENTS (BUTTONS, INPUTS) */
.btn {
    padding: 12px 20px; font-size: 1rem; font-weight: 400; font-family: var(--font-body);
    border: 1px solid var(--gold); border-radius: 4px; background: transparent;
    color: var(--gold); cursor: pointer; transition: var(--transition-fast);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
}
.btn:hover { background: rgba(255, 215, 0, 0.1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.3), 0 0 25px var(--soft-violet); transform: translateY(-2px); }
.btn.primary { background: var(--gold); color: var(--deep-purple); font-weight: 600;}
.btn.primary:hover { background: var(--gold-light); color: var(--deep-purple); box-shadow: 0 0 15px var(--gold), 0 0 25px var(--soft-violet); }
.btn:active, .tome-unlock-btn:active, .action-button:active {
    transform: translateY(1px) scale(0.98);
    box-shadow: 0 2px 10px rgba(0,0,0,0.3), inset 0 2px 5px rgba(0,0,0,0.2);
    transition: transform 0.1s ease;
}

.text-input {
    width: 100%; padding: 14px; font-size: 1rem; border: 1px solid var(--text-secondary);
    border-radius: 4px; background: rgba(2, 4, 27, 0.5); color: var(--gold-light);
    font-family: var(--font-body); transition: var(--transition-fast);
    box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
}
.text-input:focus { border-color: var(--gold); box-shadow: 0 0 10px rgba(255, 215, 0, 0.3), inset 0 0 5px rgba(0,0,0,0.5); outline: none;}
.data-list { list-style-type: '★ '; padding-left: 1.5rem; color: var(--text-primary); }
.data-list li { margin-bottom: 0.75rem; padding-left: 0.5rem; }

/* MODALS (Still Panels) */
.modal { 
    position: fixed; inset: 0; z-index: 5000; display: none; align-items: center; justify-content: center;
    background: rgba(2, 4, 27, 0.7); backdrop-filter: blur(8px);
}
.modal.active { display: flex; animation: fade-in 0.3s; }
.modal-content {
    background-color: var(--deep-purple); color: var(--text-primary); border: 2px solid var(--gold);
    padding: 2rem; border-radius: 12px; max-width: 800px; width: 90%;
    animation: fade-in-up 0.5s; max-height: 90vh; overflow-y: auto;
    box-shadow: 0 0 40px rgba(255, 215, 0, 0.3), 0 0 60px var(--soft-violet);
    position: relative;
}
.modal-close-btn {
    position: absolute; top: 10px; right: 15px;
    background: none; border: none; color: var(--text-secondary);
    font-size: 2rem; cursor: pointer; transition: var(--transition-fast);
}
.modal-close-btn:hover { color: var(--gold); transform: rotate(90deg); }

/* BOOK PASSWORD GATE (TOME REDESIGN) */
#book-password-gate .modal-content {
    max-width: 500px;
    text-align: center;
    background: linear-gradient(145deg, #1a122a 0%, #0c0714 100%);
    border: 1px solid var(--gold);
    box-shadow: 0 0 50px var(--soft-violet), inset 0 0 30px var(--deep-purple);
    padding: 2rem;
    position: relative;
}

.tome-lock-icon {
    width: 60px; height: 60px;
    background-color: transparent;
    border: 2px solid var(--gold);
    color: var(--gold);
    border-radius: 50%;
    margin: 0 auto 1.5rem auto;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    box-shadow: 0 0 15px var(--gold);
}
.tome-lock-icon::before {
    content: '⚿';
    font-family: serif;
}


.tome-title {
    font-family: var(--font-display);
    font-size: 2.5rem;
    color: var(--gold-light);
    text-shadow: 0 0 15px var(--gold);
    letter-spacing: 3px;
    margin-bottom: 0.5rem;
    text-align: center;
}
.tome-subtitle {
    font-family: var(--font-body);
    font-size: 1.1rem;
    color: var(--text-secondary);
    font-style: italic;
    margin-bottom: 2rem;
    text-align: center;
}
.speak-words-label {
    font-family: var(--font-body);
    font-size: 0.9em;
    color: var(--text-secondary);
    letter-spacing: 2px;
    margin-bottom: 10px;
    display: block;
    text-transform: uppercase;
}
.tome-input {
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255, 215, 0, 0.4);
    border-radius: 8px;
    color: var(--gold-light);
    font-family: var(--font-handwriting);
    font-size: 1.5rem;
    text-align: center;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.1), inset 0 0 8px rgba(0,0,0,0.7);
}
.tome-input::placeholder { color: rgba(255, 215, 0, 0.4); font-family: var(--font-body); font-style: italic;}

.tome-unlock-btn {
    width: 100%;
    margin-top: 1.5rem;
    padding: 15px 20px;
    font-family: var(--font-display);
    font-size: 1.2rem;
    letter-spacing: 1px;
    background: linear-gradient(90deg, #b38e00, var(--gold));
    color: var(--space-black);
    border: 1px solid var(--gold-light);
    border-radius: 8px;
    box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
}
.tome-unlock-btn:hover {
    background: var(--gold-light);
    box-shadow: 0 5px 30px var(--gold), 0 0 40px var(--soft-violet);
    transform: translateY(-3px) scale(1.02);
}
.tome-unlock-btn .btn-icon {
    margin-right: 10px;
    font-size: 1.2rem;
}

.hint-text {
    font-family: var(--font-body);
    font-size: 0.9em;
    color: var(--text-secondary);
    margin-top: 1.5rem;
    font-style: italic;
}

/* BOOK PANEL */
.book-actions-sticky {
    position: sticky; top: -100px;
    background: linear-gradient(to bottom, var(--space-black) 60%, transparent);
    padding: 1rem 0 2rem 0; margin-bottom: 1.5rem;
    z-index: 10; display: flex; gap: 0.5rem;
}
.book-layout { display: grid; grid-template-columns: 250px 1fr; gap: 1.5rem; }
#chapter-list-container { 
    border-right: 1px solid var(--gold);
    padding-right: 1.5rem; max-height: 500px; overflow-y: auto; 
    box-shadow: 5px 0 15px rgba(255, 215, 0, 0.1);
}
.chapter-item { position: relative; padding: 0.8rem; border-bottom: 1px solid transparent; cursor: pointer; transition: var(--transition-fast); border-radius: 4px; }
.chapter-item:hover { background: rgba(74, 14, 78, 0.5); }
.chapter-item.active { font-weight: 600; color: var(--gold); border-left: 3px solid var(--gold); background: rgba(74, 14, 78, 0.7); box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
.chapter-item .chapter-title { font-family: var(--font-body); font-size: 1.1rem; }
.chapter-item .chapter-meta { font-size: 0.8rem; color: var(--text-secondary); }
.chapter-actions { position: absolute; right: 5px; top: 50%; transform: translateY(-50%); opacity: 0; transition: var(--transition-fast); display: flex; gap: 0.5rem; pointer-events: none; }
.chapter-item:hover .chapter-actions { opacity: 1; pointer-events: all; }
.chapter-action-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 1.1rem; padding: 0.25rem; transition: var(--transition-fast); }
.chapter-action-btn:hover { color: var(--gold); transform: scale(1.1); }

#chapter-content-container {
    padding: 1rem;
    background: rgba(17, 12, 31, 0.6);
    border-radius: 8px;
    border: 1px solid rgba(255, 215, 0, 0.2);
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    line-height: 1.8;
}
#chapter-content-container h3 {
    font-family: var(--font-display);
    color: var(--gold);
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    margin-bottom: 0.5rem;
}
#chapter-content-container p {
    margin-bottom: 1em;
    color: var(--gold-light);
}
#chapter-content-container em {
    color: var(--text-secondary);
    font-style: italic;
    display: block;
    margin-bottom: 1rem;
}


/* GALLERY PANEL */
.upload-button-container {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
}
#gallery-filters { display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center;}
.gallery-filter-btn.active { background: var(--gold); color: var(--deep-purple); font-weight: 600; }
#gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem; }
.polaroid-item {
    background: transparent; border: none; padding: 0;
    box-shadow: none; position: relative; cursor: pointer; transition: var(--transition-slow);
}
.polaroid-item:hover { transform: scale(1.05); }
.polaroid-item img {
    width: 100%; height: auto; display: block; border-radius: 4px;
    border: 1px solid var(--gold);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
}
.polaroid-caption {
    padding-top: 10px; text-align: center;
    font-family: var(--font-handwriting);
    font-size: 1.5rem; color: var(--gold-light);
}

/* --- CHRONICLE PANEL (REDESIGN) --- */
#chronicle-panel .star-chart-container {
    position: relative;
    width: 100%;
    min-height: 400px;
    background: radial-gradient(ellipse at center, rgba(74, 14, 78, 0.6) 0%, rgba(2, 4, 27, 0) 70%);
    border: 2px solid var(--gold);
    border-radius: 15px;
    margin-top: 2rem;
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.4), 0 0 50px var(--soft-violet);
    overflow: hidden;
}
#chronicle-panel .constellation-lines {
    position: absolute;
    width: 100%; height: 100%;
    stroke: rgba(255, 215, 0, 0.5);
    stroke-width: 1.5;
    stroke-dasharray: 5 5;
    animation: fadeInStroke 3s ease-out forwards;
}
@keyframes fadeInStroke {
    from { stroke-dashoffset: 1000; opacity: 0; }
    to { stroke-dashoffset: 0; opacity: 1; }
}

#chronicle-panel .star-wrapper {
    position: absolute;
    transform: translate(-50%, -50%);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.3s ease;
    z-index: 1;
}
#chronicle-panel .star {
    width: 12px; height: 12px;
    background: var(--gold);
    border-radius: 50%;
    box-shadow: 0 0 10px 2px var(--gold);
    transition: var(--transition-fast);
    animation: float 5s ease-in-out infinite alternate;
}
#chronicle-panel .star-wrapper:hover .star, #chronicle-panel .star-wrapper.active .star {
    animation: star-pulse 1.5s infinite, float 5s ease-in-out infinite alternate;
    background: var(--gold-light);
    box-shadow: 0 0 15px 5px var(--gold-light), 0 0 25px 8px var(--soft-violet);
}
#chronicle-panel .star-label {
    color: var(--text-secondary);
    font-size: 0.8rem;
    padding-top: 5px;
    opacity: 0;
    transition: var(--transition-fast);
    white-space: nowrap;
    text-shadow: 0 0 5px rgba(0,0,0,0.5);
}
#chronicle-panel .star-wrapper:hover .star-label, #chronicle-panel .star-wrapper.active .star-label {
    opacity: 1;
    color: var(--gold);
    transform: translateY(-5px);
}
#chronicle-panel #star-info-box {
    position: absolute;
    bottom: -100px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    max-width: 600px;
    background: linear-gradient(135deg, rgba(74, 14, 78, 0.8), rgba(2, 4, 27, 0.9));
    border: 2px solid var(--gold);
    border-top: 5px solid var(--gold);
    border-radius: 10px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.3), 0 0 40px var(--soft-violet);
    z-index: 2;
}
#chronicle-panel #star-info-box.active {
    bottom: 20px;
    opacity: 1;
    pointer-events: all;
}
#chronicle-panel #star-info-box.inactive {
    bottom: -150px;
    opacity: 0;
    pointer-events: none;
}
#chronicle-panel #star-info-date { display: block; color: var(--text-secondary); font-family: var(--font-body); margin-bottom: 0.5rem; }
#chronicle-panel #star-info-title { font-family: var(--font-handwriting); font-size: 2.2rem; color: var(--gold); margin: 0.5rem 0; text-shadow: 0 0 10px var(--gold); }
#chronicle-panel #star-info-desc { color: var(--gold-light); font-size: 1.1em; line-height: 1.6; }


/* --- GUIDE PANEL (REDESIGN) --- */
#guide-panel .holodeck-interface {
    border: 2px solid var(--gold);
    border-radius: 15px;
    background: linear-gradient(160deg, rgba(74, 14, 78, 0.7), rgba(2, 4, 27, 0.8));
    overflow: hidden;
    box-shadow: 0 0 40px rgba(255, 215, 0, 0.3), 0 0 60px var(--soft-violet);
}
#guide-panel .holodeck-tabs {
    display: flex;
    flex-wrap: wrap;
    background: rgba(74, 14, 78, 0.9);
    padding: 0.8rem;
    border-bottom: 2px solid var(--gold);
    position: relative;
    z-index: 1;
}
#guide-panel .holo-tab {
    flex: 1 1 auto;
    padding: 0.8rem 1rem;
    background: transparent;
    border: none;
    color: var(--text-secondary);
    font-family: var(--font-display);
    font-size: 1.1rem;
    cursor: pointer;
    transition: var(--transition-fast);
    border-bottom: 3px solid transparent;
    text-shadow: 0 0 5px rgba(0,0,0,0.5);
}
#guide-panel .holo-tab:hover { color: var(--gold-light); }
#guide-panel .holo-tab.active { 
    color: var(--gold); border-bottom-color: var(--gold); 
    background: rgba(255, 215, 0, 0.1);
    text-shadow: 0 0 10px var(--gold);
}
#guide-panel .holo-pane h3 { 
    color: var(--gold); margin-bottom: 1rem;
    text-shadow: 0 0 15px var(--gold), 0 0 20px var(--soft-violet);
    font-size: 1.8rem;
    font-family: var(--font-display);
    text-align: center;
}

/* --- GUIDE PANEL (REDESIGN V3 - Content Styling) --- */
#guide-panel .holodeck-content { padding: 2rem; }
#guide-panel .holo-pane { display: none; }
#guide-panel .holo-pane.active { display: block; animation: fade-in 0.8s ease-out; }

/* --- Love Calculator (Physics Tab) Redesign --- */
.love-calculator-container { 
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    background: #0a192f; border: 1px solid #30d5c8; border-radius: 8px; padding: 1.5rem; 
    box-shadow: 0 0 20px rgba(48, 213, 200, 0.2), inset 0 0 15px rgba(48, 213, 200, 0.1); 
}
.love-calculator-container .calc-title { font-family: 'Courier New', monospace; color: #30d5c8; text-shadow: 0 0 10px #30d5c8; text-align: center; font-size: 1.5rem; letter-spacing: 2px; grid-column: 1 / -1; }
.love-calculator-container .calc-subtitle { font-family: 'Courier New', monospace; color: #8892b0; text-align: center; font-size: 0.9rem; margin-bottom: 2rem; }
.love-calculator-container .calc-section { padding: 1rem; border: 1px dashed rgba(48, 213, 200, 0.3); border-radius: 4px; display: flex; flex-direction: column; }
.love-calculator-container .calc-sub-header { font-family: 'Courier New', monospace; color: #30d5c8; border-bottom: 1px solid #30d5c8; padding-bottom: 0.5rem; margin-bottom: 1rem; }
.love-calculator-container .calc-formula-box { background: rgba(0,0,0,0.2); padding: 1rem; }
.love-calculator-container .calc-formula { font-size: 1.8rem; text-align: center; color: #f5f5f5; }
.love-calculator-container .calc-formula-vars { font-family: 'Courier New', monospace; list-style-type: none; padding: 0; margin: 1rem 0; color: #8892b0; font-size: 0.85rem; }
.love-calculator-container .calc-result { font-family: 'Courier New', monospace; color: #30d5c8; text-align: center; font-weight: bold; }
.love-calculator-container pre { background: #020c1b; color: #30d5c8; padding: 1rem; border-radius: 4px; font-family: 'Courier New', monospace; white-space: pre-wrap; word-break: break-all; line-height: 1.6; font-size: 0.9rem; text-shadow: 0 0 5px rgba(48, 213, 200, 0.5); }
.love-calculator-container .calc-nav { margin-top: 1rem; text-align: center; font-family: 'Courier New', monospace; color: #8892b0; }
.love-calculator-container .calc-nav a { color: #30d5c8; text-decoration: none; }
.love-calculator-container .calc-nav a:hover { text-decoration: underline; text-shadow: 0 0 5px #30d5c8; }


/* --- V4 Content Styling --- */
.item-check { color: var(--jade); }

/* Compatibility Analysis */
.compat-analysis-grid { display: grid; gap: 1rem; }
.compat-item { font-family: 'Courier New', monospace; }
.compat-header { display: flex; justify-content: space-between; color: #8892b0; font-size: 0.8rem; margin-bottom: 0.25rem; }
.compat-bar-track { background: #020c1b; height: 10px; border-radius: 5px; overflow: hidden; }
.compat-bar-fill { height: 100%; background: #30d5c8; width: 0; transition: width 1.5s cubic-bezier(0.25, 1, 0.5, 1); }

/* Trajectory Analysis */
.trajectory-container { display: flex; flex-direction: column; height: 100%; }
#trajectory-svg { width: 100%; height: auto; background: #020c1b; border-radius: 4px; padding: 1rem; }
#trajectory-path { stroke-dasharray: 1000; stroke-dashoffset: 1000; animation: draw-path 3s ease-out forwards; }
@keyframes draw-path { to { stroke-dashoffset: 0; } }
.trajectory-summary { display: grid; gap: 1rem; margin-top: 1rem; }
.summary-item { background: #020c1b; padding: 0.75rem; border-radius: 4px; border-left: 2px solid #30d5c8; }
.summary-title { font-family: 'Courier New', monospace; color: #ccd6f6; font-size: 0.9rem; margin-bottom: 0.5rem; }
.summary-detail { font-family: 'Courier New', monospace; color: #8892b0; font-size: 0.8rem; line-height: 1.5; }

/* Theorem Grid */
.theorem-grid-tech { display: grid; grid-template-columns: 1fr; gap: 1rem; }
.theorem-card-tech { background: #020c1b; padding: 1rem; border-radius: 4px; border-left: 2px solid #30d5c8; }
.theorem-title-tech { font-family: 'Courier New', monospace; color: #ccd6f6; font-weight: bold; font-size: 0.9rem; }
.theorem-equation-tech { font-family: 'Times New Roman', serif; font-size: 1.5rem; color: #f5f5f5; margin: 0.5rem 0; }
.theorem-desc-tech { font-family: 'Courier New', monospace; color: #8892b0; font-size: 0.8rem; }

/* Probability Display */
.probability-display { text-align: center; background: #020c1b; padding: 1.5rem; border-radius: 4px; }
.prob-main-value { font-family: 'Courier New', monospace; font-size: 2.5rem; color: #30d5c8; text-shadow: 0 0 15px #30d5c8; font-weight: bold; }
.prob-label { color: #8892b0; margin: 0.5rem 0 1rem 0; }
.prob-conclusion { color: #f779dd; font-size: 1.1rem; font-style: italic; margin-bottom: 1.5rem; }
.prob-sub-items { display: flex; justify-content: center; gap: 1.5rem; font-size: 0.8rem; color: #8892b0; border-top: 1px dashed rgba(48, 213, 200, 0.3); padding-top: 1rem; }

.status-ok { color: var(--jade); font-weight: bold; }
.status-destined { color: var(--glow-magenta); font-weight: bold; }
/* Radar Chart & Glitch Effects */
.radar-chart-container { position: relative; width: 300px; height: 300px; margin: 1rem auto; background: url(./photos/radar_bg.png) center/cover; transition: transform 0.2s; }
.system-failure .radar-chart-container { animation: glitch-shake 0.2s infinite; }
.system-failure .radar-chart-container::before {
    content: '';
    position: absolute;
    inset: 0;
    background: inherit;
    z-index: 2;
    animation: glitch-color 0.5s infinite;
    left: 2px;
    mix-blend-mode: color-dodge;
}
.radar-chart-container.glitching { animation: glitch-shake 0.2s infinite; }
.radar-chart-container.glitching::before, .radar-chart-container.glitching::after {
    content: '';
    position: absolute;
    inset: 0;
    background: inherit;
    z-index: 2;
}
.radar-chart-container.glitching::before {
    animation: glitch-color 0.5s infinite;
    left: 2px;
    mix-blend-mode: color-dodge;
}
.radar-chart-container.glitching::after {
    background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0) 100%);
    background-size: 100% 4px;
    animation: scanlines 0.2s linear infinite;
    z-index: 3;
    pointer-events: none;
}
#radar-chart { width: 100%; height: 100%; }
.radar-center-score { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'Courier New', monospace; font-size: 2.5rem; font-weight: bold; color: #30d5c8; text-shadow: 0 0 15px #30d5c8; }
.analysis-summary { margin-top: 1rem; text-align: center; }
.summary-item-tech { font-family: 'Courier New', monospace; color: #8892b0; margin-bottom: 0.5rem; }

/* Fluctuation Simulator Styles */
#fluctuation-simulator {
    grid-column: 2 / 3; /* Place it next to the radar chart */
}
.simulator-input-group { display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem; }
.simulator-input-group label { font-family: 'Courier New', monospace; color: #8892b0; }
.simulator-input-group .text-input { background: #020c1b; border-color: #30d5c8; text-align: center; font-size: 1.2rem; }

.simulator-controls { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; }
#waveform-canvas { background: #020c1b; border-radius: 4px; width: 100%; }


@media (min-width: 768px) {
    /* No change needed, grid handles it */
}

@media (max-width: 900px) {
    .love-calculator-container {
        grid-template-columns: 1fr;
    }
    #fluctuation-simulator {
        grid-column: 1 / -1; /* Stack on mobile */
    }
}

/* --- Interactive Physics Calculator Styles --- */
.interactive-calc {
    border-style: solid;
    border-color: #30d5c8;
    background: rgba(48, 213, 200, 0.05);
}
.slider-control {
    margin-bottom: 1.5rem;
}
.slider-control label {
    display: block;
    font-family: 'Courier New', monospace;
    color: #8892b0;
    margin-bottom: 0.5rem;
}
.love-slider {
    -webkit-appearance: none;
    width: 100%;
    height: 8px;
    background: #020c1b;
    border: 1px solid #30d5c8;
    border-radius: 4px;
    outline: none;
}
.love-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: #30d5c8;
    cursor: pointer;
    border-radius: 50%;
    box-shadow: 0 0 10px #30d5c8;
}
.interactive-result-box { text-align: center; margin-top: 2rem; padding: 1rem; background: #020c1b; }
.result-label { font-family: 'Courier New', monospace; color: #8892b0; font-size: 0.9rem; }
.result-value { font-family: 'Courier New', monospace; color: #30d5c8; font-size: 2.5rem; font-weight: bold; text-shadow: 0 0 15px #30d5c8; margin: 0.5rem 0; transition: text-shadow 0.3s ease; }
.result-value.updated { text-shadow: 0 0 25px #30d5c8, 0 0 40px #fff; }
.result-sub-label { font-family: 'Courier New', monospace; color: #8892b0; font-size: 0.8rem; font-style: italic; }


#guide-panel .physics-formula {
    font-family: 'Times New Roman', serif;
    font-size: 2.5rem;
    color: var(--jade);
    text-align: center;
    margin: 2rem 0;
    text-shadow: 0 0 15px var(--jade);
    animation: pulse-glow 2s infinite alternate;
}
#guide-panel .anatomy-display { 
    display: flex; justify-content: space-around; margin-top: 2rem; padding: 1.5rem; border-radius: 10px;
    border: 1px solid var(--border-glass); background: var(--highlight-glass);
}

/* --- Anatomy of Us Redesign --- */
.anatomy-visualization { border: 1px solid var(--border-glass); background: var(--highlight-glass); padding: 2rem; border-radius: 12px; }
.anatomy-profiles { gap: 2rem; }
.profile-avatar { transition: transform 0.4s ease; }
.anatomy-profile:hover .profile-avatar { transform: scale(1.1); }
.avatar-glow { animation: pulse-glow 4s infinite ease-in-out; }
.anatomy-point-enhanced { border: 1px solid transparent; transition: var(--transition-fast); }
.anatomy-point-enhanced:hover { border-color: var(--gold); background: rgba(255, 215, 0, 0.05); transform: translateX(5px); }
.connection-bridge { flex: 0.5; } /* Give it less space */
.bridge-heart { animation: pulse-glow 2s infinite, float 4s infinite ease-in-out; }
.bridge-pulse { position: absolute; width: 15px; height: 15px; background: var(--gold); border-radius: 50%; box-shadow: 0 0 10px var(--gold); opacity: 0; }
@keyframes pulse-right { 0% { left: 0; opacity: 1; } 100% { left: 100%; opacity: 0; transform: scale(0.5); } }
@keyframes pulse-left { 0% { right: 0; opacity: 1; } 100% { right: 100%; opacity: 0; transform: scale(0.5); } }

.sync-hearts-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
}
.hearts-to-sync { display: flex; gap: 1rem; font-size: 2rem; }
.heart-to-sync { cursor: pointer; transition: transform 0.2s; }
.heart-to-sync:hover { transform: scale(1.2); }
@keyframes heartbeat {
    0% { transform: scale(1); }
    14% { transform: scale(1.3); }
    28% { transform: scale(1); }
    42% { transform: scale(1.3); }
    70% { transform: scale(1); }
}

/* --- Artifacts Redesign --- */
.artifact-card {
    background: linear-gradient(145deg, rgba(74,14,78,0.5), rgba(2,4,27,0.7));
    border: 1px solid var(--border-glass);
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}
.artifact-card:hover {
    border-color: var(--gold);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 20px var(--soft-violet);
}
.artifact-rarity { font-family: var(--font-display); letter-spacing: 1px; }
.artifact-detail-modal .artifact-modal-content { background: linear-gradient(145deg, var(--deep-purple), var(--space-black)); }
.form-group {
    margin-bottom: 1rem;
}
.form-group label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); }


#guide-panel .artifact-grid { 
    display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 1.5rem; text-align: center; margin-top: 2rem; 
    padding: 1rem;
    border: 1px dashed rgba(255, 215, 0, 0.3);
    border-radius: 10px;
}
#guide-panel .artifact-item { 
    font-size: 3.5rem; cursor: pointer; transition: var(--transition-fast); color: var(--text-primary);
    text-shadow: 0 0 10px var(--gold);
}
#guide-panel .artifact-item:hover { 
    transform: scale(1.3); color: var(--gold); 
    text-shadow: 0 0 20px var(--gold), 0 0 30px var(--soft-violet); 
}

/* --- Lexicon Redesign --- */
.lexicon-list-enhanced .lexicon-entry {
    border-left: 3px solid var(--glow-cyan);
    transition: var(--transition-fast);
}
.lexicon-list-enhanced .lexicon-entry:hover {
    background: rgba(100, 255, 218, 0.05);
    transform: scale(1.02);
}
.lexicon-list-enhanced dt { text-shadow: 0 0 5px var(--gold); }
.lexicon-list-enhanced dd { color: var(--text-primary); }
.lexicon-usage { background: rgba(100, 255, 218, 0.05); }

/* --- SANCTUARY PANEL --- */
#nebula-of-solitude {
    width: 100%;
    height: 100%;
    padding: 0 !important; 
    background: none !important;
}


/* DETAILED QUILL EDITOR STYLES */
#quill-editor-container { background: var(--space-black); border: 1px solid var(--gold); border-radius: 4px; }
.ql-toolbar { background: var(--deep-purple); border-bottom: 1px solid var(--gold) !important; border-radius: 4px 4px 0 0; }
.ql-toolbar .ql-stroke { stroke: var(--gold-light); }
.ql-toolbar .ql-fill { fill: var(--gold-light); }
.ql-toolbar .ql-picker-label { color: var(--gold-light); }
.ql-toolbar button:hover .ql-stroke, .ql-toolbar .ql-picker-label:hover .ql-stroke { stroke: var(--gold); }
.ql-toolbar button:hover .ql-fill, .ql-toolbar .ql-picker-label:hover .ql-fill { fill: var(--gold); }
.ql-toolbar .ql-picker-label:hover { color: var(--gold) !important; }
.ql-toolbar .ql-active .ql-stroke { stroke: var(--gold); }
.ql-toolbar .ql-active .ql-fill { fill: var(--gold); }
.ql-toolbar .ql-active .ql-picker-label { color: var(--gold) !important; }
.ql-editor { color: var(--text-primary); min-height: 300px; line-height: 1.8; }
.ql-editor.ql-blank::before { color: var(--text-secondary); font-style: normal !important; }
.ql-snow .ql-picker.ql-expanded .ql-picker-options { background-color: var(--space-black); border-color: var(--gold); }
.ql-snow .ql-picker-options .ql-picker-item { color: var(--gold-light); }
.ql-snow .ql-picker-options .ql-picker-item:hover { color: var(--gold); }
.modal-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; }

/* MISC */
.floating-hearts { position: fixed; pointer-events: none; font-size: 2rem; animation: float-up 3s ease-in-out; z-index: 9999; }

.floating-compliment {
    position: fixed;
    z-index: 9998;
    pointer-events: none;
    font-family: var(--font-handwriting);
    font-size: clamp(1.2rem, 2vw, 1.8rem);
    color: var(--gold-light);
    text-shadow: 0 0 10px var(--soft-violet), 0 0 5px var(--soft-violet);
    animation: float-compliment 6s ease-in-out forwards;
    padding: 10px;
    background: rgba(74, 14, 78, 0.3);
    border-radius: 10px;
    backdrop-filter: blur(2px);
}

/* --- STYLES FOR NEBULA OF SOLITUDE PANEL --- */
#nebula-of-solitude .nav-orbit { position: fixed; right: 50px; top: 50%; transform: translateY(-50%); z-index: 100; }
#nebula-of-solitude .planet-nav { width: 60px; height: 60px; border-radius: 50%; margin: 20px 0; cursor: pointer; transition: all 0.3s; position: relative; box-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
#nebula-of-solitude .planet-nav:hover { transform: scale(1.3); box-shadow: 0 0 40px rgba(255, 255, 255, 0.6); }
#nebula-of-solitude .planet-nav::after { content: attr(data-title); position: absolute; right: 70px; top: 50%; transform: translateY(-50%); background: var(--deep-purple); padding: 8px 15px; border-radius: 5px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.3s; font-size: 14px; color: var(--gold-light); }
#nebula-of-solitude .planet-nav:hover::after { opacity: 1; }
#nebula-of-solitude .planet-1 { background: linear-gradient(135deg, var(--gold) 0%, var(--deep-purple) 100%); }
#nebula-of-solitude .planet-2 { background: linear-gradient(135deg, var(--soft-violet) 0%, var(--crimson) 100%); }
#nebula-of-solitude .planet-3 { background: linear-gradient(135deg, var(--jade) 0%, var(--gold) 100%); }
#nebula-of-solitude .planet-4 { background: linear-gradient(135deg, var(--crimson) 0%, var(--soft-violet) 100%); }
#nebula-of-solitude .planet-5 { background: linear-gradient(135deg, var(--deep-purple) 0%, var(--gold) 100%); }
#nebula-of-solitude .planet-6 { background: linear-gradient(135deg, var(--soft-violet) 0%, var(--crimson) 100%); }
#nebula-of-solitude .chapter { min-height: 100vh; padding: 100px 50px; position: relative; display: none; animation: fadeInUp 1s; }
#nebula-of-solitude .chapter.active { display: block; }
#nebula-of-solitude .chapter-title { font-size: 56px; text-align: center; margin-bottom: 50px; background: linear-gradient(45deg, var(--gold), var(--soft-violet)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 30px rgba(255, 215, 0, 0.3); }
#nebula-of-solitude .chapter-content { max-width: 900px; margin: 0 auto; font-size: 20px; line-height: 1.9; color: var(--gold-light); text-align: justify; }
#nebula-of-solitude .chapter-content p { margin-bottom: 30px; text-indent: 40px; }
#nebula-of-solitude .floating { animation: floating 3s ease-in-out infinite; }
#nebula-of-solitude .overthinking-meter { width: 300px; height: 30px; background: rgba(255, 255, 255, 0.1); border-radius: 15px; margin: 30px auto; overflow: hidden; border: 2px solid var(--crimson); }
#nebula-of-solitude .meter-fill { height: 100%; background: linear-gradient(90deg, var(--soft-violet), var(--deep-purple)); width: 0%; transition: width 1s; box-shadow: 0 0 20px rgba(138, 43, 226, 0.8); }
#nebula-of-solitude .cosmic-therapist { position: fixed; bottom: 30px; left: 40px; background: rgba(138, 43, 226, 0.9); padding: 15px 25px; border-radius: 20px; max-width: 300px; font-size: 14px; box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5); display: none; animation: slideIn 0.5s; z-index: 2000; }
#nebula-of-solitude .cosmic-therapist.active { display: block; }
#nebula-of-solitude .mini-game { background: rgba(255, 255, 255, 0.05); border: 2px solid var(--gold); border-radius: 20px; padding: 30px; margin: 40px auto; max-width: 600px; text-align: center; }
#nebula-of-solitude .game-button { padding: 15px 40px; font-size: 18px; background: linear-gradient(135deg, var(--gold), var(--soft-violet)); border: none; border-radius: 25px; color: var(--deep-purple); cursor: pointer; margin: 10px; transition: all 0.3s; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4); }
#nebula-of-solitude .game-button:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6); }
#nebula-of-solitude .game-score { font-size: 24px; color: var(--gold); margin: 20px 0; }
#nebula-of-solitude .stats-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 50px auto; max-width: 1200px; }
#nebula-of-solitude .stat-card { background: rgba(255, 255, 255, 0.05); border: 2px solid var(--soft-violet); border-radius: 15px; padding: 25px; text-align: center; transition: all 0.3s; }
#nebula-of-solitude .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(138, 43, 226, 0.4); }
#nebula-of-solitude .stat-number { font-size: 36px; color: var(--gold); font-weight: bold; margin: 10px 0; }
#nebula-of-solitude .stat-label { font-size: 14px; color: var(--gold-light); text-transform: uppercase; letter-spacing: 2px; }
#nebula-of-solitude .dialogue-container { margin: 40px 0; }
#nebula-of-solitude .dialogue-left, #nebula-of-solitude .dialogue-right { margin: 20px 0; padding: 20px; border-radius: 20px; max-width: 70%; animation: slideInDialogue 0.5s; }
#nebula-of-solitude .dialogue-left { background: rgba(138, 43, 226, 0.2); border-left: 4px solid var(--soft-violet); margin-right: auto; }
#nebula-of-solitude .dialogue-right { background: rgba(220, 20, 60, 0.2); border-right: 4px solid var(--crimson); margin-left: auto; }
#nebula-of-solitude .dialogue-name { font-weight: bold; color: var(--gold); margin-bottom: 10px; font-size: 18px; }
#nebula-of-solitude .achievement { position: fixed; top: 30px; right: 30px; background: linear-gradient(135deg, var(--soft-violet), var(--deep-purple)); padding: 20px 30px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5); display: none; animation: achievementPop 0.5s; z-index: 3000; }
#nebula-of-solitude .scroll-indicator { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); animation: bounce 2s infinite; color: var(--gold); font-size: 14px; text-align: center; z-index: 50; pointer-events: none; }
#nebula-of-solitude .scroll-indicator::after { content: '↓'; display: block; font-size: 24px; }
@keyframes achievementPop { from { transform: scale(0) rotate(0deg); opacity: 0; } 50% { transform: scale(1.1) rotate(5deg); } to { transform: scale(1) rotate(0deg); opacity: 1; } }
@keyframes slideInDialogue { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
@keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); } 40% { transform: translateX(-50%) translateY(-10px); } 60% { transform: translateX(-50%) translateY(-5px); } }
#nebula-of-solitude .achievement.show { display: block; }
#nebula-of-solitude .achievement-title { font-weight: bold; font-size: 18px; margin-bottom: 5px; }
#nebula-of-solitude .achievement-text { font-size: 14px; color: var(--gold-light); }


/* --- NEW HALL CARDS (from game.html) --- */
.halls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 50px;
    padding: 20px 0;
    max-width: 1200px;
    margin: 40px auto;
}
.hall-card {
    position: relative;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    overflow: hidden;
    cursor: pointer;
    border: 4px solid rgba(255, 215, 0, 0.5);
    box-shadow: 0 10px 40px var(--shadow-color), inset 0 0 30px var(--deep-purple);
    transition: transform 0.4s ease, box-shadow 0.4s ease, border-color 0.4s ease;
}
.hall-card:hover {
    transform: scale(1.05);
    border-color: var(--gold);
    box-shadow: 0 20px 60px var(--shadow-color), 0 0 50px var(--soft-violet), inset 0 0 40px var(--deep-purple);
}
.hall-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
}
.hall-card:hover img { transform: scale(1.1); }
.hall-overlay {
    position: absolute;
    inset: 0;
    background: rgba(26, 10, 62, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    transition: background-color 0.4s ease;
}
.hall-card:hover .hall-overlay { background: rgba(26, 10, 62, 0.4); }
.hall-overlay h2 {
    font-family: var(--font-display);
    font-size: clamp(1.5em, 4vw, 2.2em);
    color: var(--gold-light);
    text-shadow: 0 0 15px var(--shadow-color), 0 0 20px var(--soft-violet);
}

/* --- GAMES LAYOUT & CARD STYLING (from game.html) --- */
.games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 40px; max-width: 1200px; margin: 0 auto; }
.games-grid-duo { grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); max-width: 900px; margin: 0 auto; }
.game-card { display: flex; flex-direction: column; background: linear-gradient(135deg, var(--deep-purple), #110c1f); border-radius: 20px; padding: 30px; border: 2px solid rgba(255,215,0,0.3); box-shadow: 0 10px 30px var(--shadow-color), inset 0 0 20px rgba(74,14,78,0.5); transition: transform 0.4s ease, box-shadow 0.4s ease, border-color 0.4s ease; }
.game-card:hover { transform: translateY(-10px); border-color: rgba(255,215,0,0.8); box-shadow: 0 20px 50px var(--shadow-color), 0 0 40px rgba(138,43,226,0.5); }
.game-card-header { flex-grow: 1; }
.card-icon { font-size: 3em; margin-bottom: 20px; display: block; text-shadow: 0 0 20px var(--gold); color: var(--gold); }
.game-card h2 {
    font-family: var(--font-chinese);
    font-size: 2em;
    color: var(--gold);
    margin-bottom: 15px;
    text-align: center;
}
.game-card p { font-size: 1.1em; line-height: 1.8; color: var(--gold-light); margin-bottom: 30px; }
.action-button { background: linear-gradient(135deg, var(--deep-purple), var(--crimson)); color: var(--gold-light); border: 2px solid rgba(255,215,0,0.5); padding: 15px 35px; border-radius: 30px; font-size: 1.1em; font-family: var(--font-display); letter-spacing: 2px; cursor: pointer; transition: all 0.4s ease; box-shadow: 0 5px 15px var(--shadow-color); margin-top: auto; }
.action-button:hover { transform: translateY(-5px); border-color: var(--gold); box-shadow: 0 10px 25px var(--shadow-color), 0 0 20px var(--crimson); }
.back-button { display: block; margin: 0 auto 40px auto; }
.games-section { display: none; }
.games-section:target { display: block; }

/* --- GAME UI ELEMENTS (from game.html) --- */
.score-display, .result-display { font-family: var(--font-display); text-align: center; margin: 20px 0; padding: 15px; border-radius: 10px; }
.score-display { font-size: 1.8em; color: var(--gold); background: rgba(74,14,78,0.3); border: 1px solid rgba(255,215,0,0.3); }
.result-display { font-size: 1.2em; color: var(--gold-light); background: rgba(74,14,78,0.6);}
.result-display.success { background: rgba(0,168,107,0.2); color: var(--jade); border: 1px solid var(--jade); }
.result-display.fail { background: rgba(220,20,60,0.2); color: var(--crimson); border: 1px solid var(--crimson); }
.cosmic-timer { font-family: var(--font-display); font-size: 4em; color: var(--crimson); text-align: center; margin: 20px 0; text-shadow: 0 0 20px var(--crimson); animation: pulse 1s infinite; }

@keyframes timer-drain { from { width: 100%; } to { width: 0%; } }
.timer-bar-container { width: 100%; height: 8px; background: rgba(74,14,78,0.5); border-radius: 4px; margin: 15px 0; }
.timer-bar { height: 100%; background: linear-gradient(90deg, var(--crimson), var(--gold)); border-radius: 4px; animation: timer-drain 10s linear; animation-play-state: running; }
.question-box { background: rgba(74,14,78,0.4); padding: 25px; border-radius: 10px; margin: 20px 0; border-left: 4px solid var(--gold); font-size: 1.2em; font-style: italic; color: var(--gold-light); }
.choice-btn { display: block; width: 100%; text-align: left; padding: 18px; margin: 10px 0; background: rgba(74,14,78,0.6); border: 2px solid rgba(255,215,0,0.3); color: var(--gold-light); font-size: 1.1em; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; }
.choice-btn:hover:not(:disabled) { background: rgba(138,43,226,0.4); border-color: var(--gold); transform: translateX(10px); color: var(--gold); }
.choice-btn:disabled { cursor: default; opacity: 0.7; }

/* JIGSAW PUZZLE STYLES */
#jigsaw-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; max-width: 900px; margin: auto; }
#jigsaw-pieces-container { width: 250px; min-height: 400px; background: rgba(0,0,0,0.6); border: 2px dashed rgba(255,215,0,0.4); border-radius: 10px; padding: 10px; display: flex; flex-wrap: wrap; gap: 5px; align-content: flex-start;}
#jigsaw-board { display: grid; border: 2px solid var(--gold); box-shadow: 0 0 20px var(--gold), 0 0 30px var(--soft-violet); }
.jigsaw-piece { cursor: grab; background-size: 400px 400px; transition: transform 0.2s, box-shadow 0.2s; border: 1px solid rgba(0,0,0,0.3);}
.jigsaw-piece:hover { transform: scale(1.1); box-shadow: 0 0 15px var(--gold); z-index: 10; }
.jigsaw-slot { 
    background: rgba(0,0,0,0.6); border: 1px solid rgba(255,215,0,0.1);
    position: relative; display: flex; align-items: center; justify-content: center;
    font-size: 2em; color: rgba(255, 215, 0, 0.3);
    cursor: pointer; transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
}
.jigsaw-slot:hover { background-color: rgba(255, 215, 0, 0.1); }
.jigsaw-slot.highlighted { background-color: rgba(255, 215, 0, 0.2); box-shadow: 0 0 15px var(--gold); color: var(--gold); }
.jigsaw-slot .jigsaw-piece { cursor: default; border: none; }
.jigsaw-slot .jigsaw-piece:hover { transform: none; box-shadow: none; }
#jigsaw-controls { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:20px;}
@keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);}}
.shake-error { animation: shake 0.3s linear; }

/* MEMORY & TAROT STYLES */
.memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
.memory-card { aspect-ratio: 1; background: linear-gradient(135deg, var(--deep-purple), #110c1f); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: clamp(1.5em, 5vw, 2.5em); color: var(--gold); cursor: pointer; border: 2px solid rgba(255,215,0,0.4); transition: transform 0.6s; transform-style: preserve-3d; }
.memory-card .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 10px; }
.memory-card .back { background: linear-gradient(135deg, var(--deep-purple), var(--crimson)); }
.memory-card .front { transform: rotateY(180deg); background: rgba(255,215,0,0.2); color: var(--gold); }
.memory-card.flipped { transform: rotateY(180deg); }
.memory-card.matched { border-color: var(--jade); box-shadow: 0 0 20px var(--jade); }
.tarot-card { width: 220px; height: 350px; margin: 20px auto; perspective: 1000px; cursor: pointer; }
.tarot-inner { width: 100%; height: 100%; position: relative; transition: transform 0.8s; transform-style: preserve-3d; }
.tarot-card.flipped .tarot-inner { transform: rotateY(180deg); }
.tarot-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; border: 3px solid var(--gold); display: flex; align-items: center; justify-content: center; text-align: center; }
.tarot-back { background: linear-gradient(135deg, var(--deep-purple), #111); font-size: 4em; color: var(--gold); }
.tarot-front { background: #000; transform: rotateY(180deg); flex-direction: column; padding: 20px; color: var(--gold-light); }

/* REWARD & GAME PLAY MODAL STYLING (from game.html) */
.reward-modal { display: none; position: fixed; z-index: 5001; inset: 0; background: rgba(2, 4, 27, 0.8); backdrop-filter: blur(5px); animation: fade-in 0.5s; text-align: center; }
.reward-modal-content { position: relative; display: inline-block; vertical-align: middle; top: 50%; transform: translateY(-50%); background: #110c1f; padding: 30px; border-radius: 20px; border: 2px solid var(--gold); text-align: center; box-shadow: 0 0 50px var(--soft-violet); width: 90%; max-width: 500px; }
.reward-modal h2 {
    font-family: var(--font-display);
    color: var(--gold);
    margin-bottom: 20px;
    text-shadow: 0 0 10px var(--gold);
    text-align: center;
}
.reward-modal img { max-width: 100%; max-height: 60vh; border-radius: 10px; margin-top: 10px; border: 2px solid var(--gold); }
.reward-modal p { font-family: var(--font-body); font-size: 1.4em; line-height: 1.6; color: var(--gold-light); }
.close-button { position: absolute; top: 15px; right: 20px; font-size: 2em; cursor: pointer; color: var(--text-secondary); z-index: 1001; transition: var(--transition-fast); }
.close-button:hover { color: var(--gold); transform: rotate(90deg); }

.game-play-modal-content {
    position: relative;
    display: inline-block;
    vertical-align: middle;
    top: 50%;
    transform: translateY(-50%);
    background: #110c1f;
    padding: 40px;
    border-radius: 20px;
    border: 2px solid var(--gold);
    text-align: left;
    box-shadow: 0 0 50px var(--soft-violet);
    width: auto;
    max-width: 95vw;
    max-height: 90vh;
    overflow-y: auto;
    transition: max-width 0.4s ease;
}
.game-play-modal-content.size-small { max-width: 500px; }
.game-play-modal-content.size-medium { max-width: 800px; }
.game-play-modal-content.size-large { max-width: 1100px; }

#game-play-area .game-card-header {
    text-align: center;
    border-bottom: 2px solid rgba(255, 215, 0, 0.5);
    padding-bottom: 20px;
    margin-bottom: 30px;
}
#game-play-area .game-card-header h2 { color: var(--gold); }
#game-play-area .game-card-header p { color: var(--text-secondary); font-size: 1.1em; max-width: 600px; margin-left: auto; margin-right: auto; }

.game-content { display: none; }

/* SCROLL TO TOP BUTTON */
#scroll-to-top {
    display: none; /* Hidden by default */
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 2001;
    border: none;
    outline: none;
    background-color: var(--gold);
    color: var(--deep-purple);
    cursor: pointer;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 24px;
    box-shadow: 0 5px 15px var(--shadow-color);
    transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
}
#scroll-to-top:hover {
    background-color: var(--gold-light);
    transform: scale(1.1);
}

/* LIGHTBOX STYLES */
#lightbox {
    z-index: 6000;
}
.lightbox-content {
    position: relative;
    max-width: 90vw;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
}
.lightbox-image {
    max-width: 100%;
    max-height: 80vh;
    object-fit: contain;
    border: 3px solid var(--gold);
    border-radius: 4px;
}
.lightbox-info {
    padding: 1rem;
    text-align: center;
}
#lightbox-caption {
    font-family: var(--font-handwriting);
    font-size: 1.8rem;
    color: var(--gold-light);
}
.lightbox-nav {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.5);
    color: var(--gold);
    border: 1px solid var(--gold);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 2rem;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
}
.lightbox-nav:hover {
    background: var(--gold);
    color: var(--deep-purple);
}
.lightbox-close { top: 20px; right: 20px; transform: none; width: 40px; height: 40px; }
.lightbox-prev { left: 20px; }
.lightbox-next { right: 20px; }
/* =================================================================== */
/* START: REORGANIZED & RESPONSIVE INNER SANCTUM STYLES V2             */
/* =================================================================== */

/* --- Keyframe Animations --- */
@keyframes sanctuary-glow {
    0%, 100% { text-shadow: 0 0 10px var(--gold), 0 0 20px var(--gold-light), 0 0 5px var(--deep-purple); }
    50% { text-shadow: 0 0 25px var(--gold), 0 0 45px var(--soft-violet), 0 0 10px var(--deep-purple); }
}
@keyframes bounce-in { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; }
}
@keyframes pulse-red { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }


/* --- Main Panel & View Layout --- */
#sanctuary-panel {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 2rem;
    position: relative;
    overflow: hidden;
}
#sanctuary-main-container {
    width: 100%;
    height: 100%;
    max-width: 1200px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    /* --- FIX: Allow scrolling for tall content --- */
    overflow-y: auto;
    /* --- FIX: Align content to the top when it overflows --- */
    align-items: flex-start;
    padding-top: 4rem;
}
/* --- ADD THIS: Ensure parent flex containers allow for scrolling content --- */
.sanctuary-view {
    display: none;
    width: 100%;
    animation: fade-in-up 0.8s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
}
.sanctuary-view.active {
    display: block;
}

/* --- FIX: Center the Guide's threshold content vertically and horizontally --- */
#guide-threshold.sanctuary-view.active {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%; /* Ensure it takes full height to center vertically */
}

/* --- ADD THIS: Center the Guide's threshold content like the Sanctuary's --- */
#guide-threshold .threshold-content {
    text-align: center;
}

/* --- 1. Threshold/Riddle View --- */
.threshold-content {
    max-width: 700px;
    margin: 0 auto;
}
.typing-text {
    font-family: var(--font-body);
    font-style: italic;
    font-size: clamp(1.4em, 2.8vw, 1.8em); /* <-- Increased font size */
    color: var(--gold-light);
    line-height: 1.8;
    min-height: 150px;
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
}
.sanctuary-riddle {
    margin-top: 1.5rem;
}
.riddle-prompt {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
}
.riddle-input {
    font-size: 1.5rem;
    max-width: 400px;
    margin: 0 auto 1.5rem auto;
}
.riddle-divider {
    font-family: var(--font-display);
    color: var(--text-secondary);
    margin: 1rem 0;
}
.riddle-question {
    margin-bottom: 1rem;
}
.riddle-choices {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
}
.riddle-feedback {
    min-height: 1.5em;
    margin-top: 1.5rem;
    font-weight: bold;
    transition: color 0.3s;
}

/* --- 2. Entrance Animation View --- */
#sanctuary-entrance-animation .door-image {
    width: clamp(250px, 40vw, 400px);
    aspect-ratio: 1 / 1;
    margin: 0 auto;
    filter: drop-shadow(0 0 15px var(--gold)) drop-shadow(0 0 25px var(--soft-violet));
    transition: transform 1.5s ease-in-out, opacity 1.5s ease-in-out;
}
#sanctuary-entrance-animation.is-opening .door-image {
    transform: scale(5);
    opacity: 0;
}

/* --- 3. Hub View --- */
.sanctuary-hub-view .hub-title {
    font-family: var(--font-display);
    font-size: clamp(2.5em, 5vw, 3.5em);
    color: var(--gold-light);
    text-align: center; /* Ensure title is centered */
    margin-bottom: 1.5rem;
    animation: sanctuary-glow 4s infinite;
}
.sanctuary-hub-view .hub-subtitle {
    font-family: var(--font-body);
    font-size: 1.2em;
    color: var(--text-secondary);
    margin: 0 auto 2.5rem auto;
    max-width: 700px;
    line-height: 1.7;
}
.hub-question-box {
    max-width: 600px;
    margin: 0 auto;
    padding: 2rem;
    border: 1px solid var(--border-glass);
    border-radius: 12px;
    background: var(--highlight-glass);
}
.hub-question-box h3 {
    font-family: var(--font-display);
    color: var(--text-secondary);
    margin-bottom: 2rem;
    letter-spacing: 1px;
}
.hub-choices {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}
.hub-choice-btn {
    background: transparent;
    border: 1px solid var(--soft-violet);
    color: var(--gold-light);
    padding: 1rem;
    border-radius: 8px;
    font-size: 1.1em;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
}
.hub-choice-btn:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: var(--gold);
    color: var(--gold);
    transform: translateY(-3px);
}
.hub-choice-btn:last-child {
    grid-column: 1 / -1; /* Make last button span full width */
}

.realm { display: none; margin-bottom: 4rem; }
.realm.active { display: block; }

.section-title {
    font-family: var(--font-display);
    font-size: clamp(2em, 4vw, 2.8em);
    color: var(--gold);
    margin-bottom: 1rem;
    animation: sanctuary-glow 4s infinite;
}
.realm-subheader {
    font-family: var(--font-body);
    color: var(--text-secondary);
    font-style: italic;
    margin-bottom: 3rem;
}
.realm-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2.5rem; /* Increased gap for better spacing */
    justify-content: center;
    margin-bottom: 4rem; /* Added margin to separate grid from back button */
}
.realm-portal {
    background: var(--highlight-glass);
    border: 2px solid var(--border-glass);
    padding: 2.5rem 1.5rem; /* Increased padding for more internal space */
    border-radius: 12px;
    cursor: pointer;
    transition: var(--transition-fast);
    aspect-ratio: 1 / 1;
    position: relative; /* For pseudo-elements */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
.realm-portal:hover {
    background: rgba(138, 43, 226, 0.15); /* Slightly more pronounced background on hover */
    transform: translateY(-8px) scale(1.03);
    border-color: var(--gold);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3), 0 0 20px var(--soft-violet);
}
.realm-icon { font-size: 3em; margin-bottom: 1rem; }
.realm-title { font-family: var(--font-display); font-size: 1.5em; color: var(--gold-light); margin-bottom: 0.5rem; }
.realm-description { color: var(--text-secondary); font-size: 0.9em; }

.book-shelf {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}
.sacred-scroll {
    background: var(--highlight-glass);
    border: 2px solid var(--border-glass);
    padding: 1.5rem;
    border-radius: 12px;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    text-align: left;
}
.sacred-scroll:hover {
    background: rgba(138, 43, 226, 0.1); /* Add a subtle background color on hover */
    transform: translateY(-5px);
    border-color: var(--gold);
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}
.scroll-icon { font-size: 2.5em; color: var(--gold); flex-shrink: 0; }
.scroll-text h3 { font-size: 1.2em; color: var(--gold-light); margin: 0 0 0.25rem 0; }
.scroll-text p { font-size: 0.9em; color: var(--text-secondary); margin: 0; }

/* --- ORNATE SANCTUARY MODAL STYLES --- */
#blessingModal .modal-content, #bookModal .modal-content {
    background: linear-gradient(145deg, var(--deep-purple), var(--space-black));
    border-width: 3px;
    box-shadow: 0 0 60px var(--soft-violet), 0 0 30px var(--gold), inset 0 0 25px rgba(74, 14, 78, 0.8);
    max-width: 650px;
    position: relative;
    padding-top: 3rem; /* Add padding for corner decorations */
    padding-bottom: 3rem;
}

/* Decorative Corners */
#blessingModal .modal-content::before,
#blessingModal .modal-content::after,
#bookModal .modal-content::before,
#bookModal .modal-content::after {
    content: '✧';
    position: absolute;
    font-size: 2.5rem;
    color: var(--gold);
    text-shadow: 0 0 15px var(--gold);
    line-height: 1;
    opacity: 0.8;
}
#blessingModal .modal-content::before { top: 10px; left: 15px; }
#blessingModal .modal-content::after { top: 10px; right: 15px; transform: rotate(90deg); }
#bookModal .modal-content::before { top: 10px; left: 15px; }
#bookModal .modal-content::after { top: 10px; right: 15px; transform: rotate(90deg); }

/* Bottom Corners */
.modal-seal::before, .modal-seal::after {
    content: '✧';
    position: absolute;
    font-size: 2.5rem;
    color: var(--gold);
    text-shadow: 0 0 15px var(--gold);
    line-height: 1;
    opacity: 0.8;
    bottom: 10px;
}
.modal-seal::before { left: 15px; transform: rotate(-90deg); }
.modal-seal::after { right: 15px; transform: rotate(180deg); }

.modal-seal {
    width: 60px; height: 60px;
    margin: 1.5rem auto -1rem auto;
    border: 2px solid var(--gold);
    border-radius: 50%;
    box-shadow: 0 0 15px var(--gold), inset 0 0 10px rgba(255,215,0,0.3);
    animation: pulse-glow 3s infinite;
}
.modal-icon {
    font-size: 4rem;
    text-shadow: 0 0 20px var(--gold), 0 0 35px var(--soft-violet);
    margin-bottom: 1rem;
}
.modal-title {
    font-family: var(--font-display);
    font-size: 2.5em;
    text-shadow: 0 0 15px var(--gold);
}
.modal-message {
    font-family: var(--font-body);
    font-size: 1.2em;
    line-height: 1.8;
    color: var(--gold-light);
    margin: 1.5rem 0;
}
.modal-message .promise {
    font-family: var(--font-body); /* Ensure consistent font */
    display: block;
    margin-top: 1.5rem;
    padding: 1rem;
    background: rgba(255, 215, 0, 0.05);
    border-left: 3px solid var(--gold);
    border-radius: 4px;
    font-size: 1em; /* Make it slightly larger */
}
.accept-button {
    margin-top: 2rem; /* Add space above the accept button */
}
.book-modal-content p {
    font-size: 1.2em; line-height: 1.8; color: var(--gold-light);
}

.back-to-hub-btn {
    margin-top: 0; /* Removed top margin as it's now on the grid */
    margin-bottom: 2rem; /* Add space at the very bottom */
}
.realm-icon { font-size: 3em; margin-bottom: 1rem; }
.realm-title { font-family: var(--font-display); font-size: 1.5em; color: var(--gold-light); margin-bottom: 0.5rem; }
.realm-description { color: var(--text-secondary); font-size: 0.9em; }

.book-shelf {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}
.sacred-scroll {
    background: var(--highlight-glass);
    border: 2px solid var(--border-glass);
    padding: 1.5rem;
    border-radius: 12px;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    text-align: left;
}
.sacred-scroll:hover {
    transform: translateY(-5px);
    border-color: var(--gold);
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}
.scroll-icon { font-size: 2.5em; color: var(--gold); flex-shrink: 0; }
.scroll-text h3 { font-size: 1.2em; color: var(--gold-light); margin: 0 0 0.25rem 0; }
.scroll-text p { font-size: 0.9em; color: var(--text-secondary); margin: 0; }

/* Specific Realm Styles */
.ritual-altar {
    background: var(--highlight-glass);
    border-radius: 8px;
    padding: 2.5rem; /* Increased padding */
    margin-top: 3rem;
    text-align: center; /* Center align content */
}
.ritual-instructions {
    color: var(--text-secondary);
    font-style: italic;
    max-width: 500px; /* Constrain width for better readability */
    margin: 0 auto 1.5rem auto; /* Center the text block */
}
.candles { display: flex; justify-content: center; gap: 1.5rem; margin: 1.5rem 0; }
.candle { width: 20px; height: 80px; background: #ccc; border-radius: 5px 5px 0 0; position: relative; cursor: pointer; }
.candle::before { content: ''; position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 5px; height: 15px; background: #555; border-radius: 2px; }
.candle.lit::after { content: ''; position: absolute; top: -30px; left: 50%; transform: translateX(-50%); width: 16px; height: 16px; background: var(--gold); border-radius: 50%; box-shadow: 0 0 15px 5px var(--gold), 0 0 25px 10px rgba(255, 165, 0, 0.7); }
.ritual-complete { display: none; margin-top: 1rem; color: var(--gold); }
.oracle-chamber { margin: 2rem 0; }
.crystal-ball { width: 150px; height: 150px; background: radial-gradient(circle at 30% 30%, #fff, var(--soft-violet)); border-radius: 50%; margin: 0 auto; cursor: pointer; box-shadow: 0 0 30px var(--soft-violet), inset 0 0 20px rgba(255,255,255,0.5); }
.oracle-prompt { color: var(--text-secondary); margin-top: 1rem; }
.oracle-text {
    font-family: var(--font-body); /* Use a more readable serif font */
    font-size: 1.3em;
    font-style: italic; /* Retain a mystical, spoken feel */
    color: var(--gold-light);
    /* Cleaner shadow for better contrast and readability */
    text-shadow: 0 0 8px rgba(255, 215, 0, 0.6), 0 1px 3px rgba(0,0,0,0.7); 
    min-height: 4em;
    transition: opacity 1s ease-in-out;
    line-height: 1.7;
    margin-top: 1rem;
}
.astral-map { margin-top: 3rem; }
.astral-map-title { font-size: 1.5rem; margin-bottom: 1rem; color: var(--gold-light); }
.constellation-canvas { background: rgba(0,0,0,0.2); border-radius: 8px; border: 1px solid var(--border-glass); }
.scratch-card-container { width: 100%; max-width: 400px; aspect-ratio: 16/9; margin: 2rem auto 0; position: relative; }
.prize-div { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; color: var(--gold-light); }
.scratch-canvas { position: absolute; inset: 0; width: 100%; height: 100%; cursor: grabbing; }

/* --- Scary Failure Screen --- */
#sanctuary-failure-overlay {
    position: fixed;
    inset: 0;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; /* Vertically center on large screens */
    background: radial-gradient(ellipse at center, #0a0005 0%, #000000 100%); /* Even darker background */
    backdrop-filter: blur(10px);
    animation: fade-in 0.8s ease-out;
    padding: 2rem;
    box-shadow: inset 0 0 200px #000; /* More intense vignette effect */
    overflow-y: auto; /* Enable scrolling on small screens */
}
.failure-header {
    margin-bottom: 2rem;
    text-align: center;
    animation: fade-in 1.2s ease-out 0.6s both;
}
.failure-skulls {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-bottom: 1rem;
}
.failure-skulls span {
    font-size: clamp(2.5rem, 6vw, 4rem); /* Larger skulls */
    color: #dc143c;
    text-shadow: 0 0 15px #dc143c, 0 0 30px #dc143c, 0 0 45px #000; /* More intense glow */
    animation: skull-wobble 2.5s ease-in-out infinite;
}
.failure-skulls span:nth-child(2) {
    animation-delay: 0.3s;
}
.failure-skulls span:nth-child(3) {
    animation-delay: 0.6s;
}
.failure-title {
    font-family: 'Cinzel Decorative', serif; /* Or a more "creepy" font if you have one loaded */
    font-size: clamp(3rem, 8vw, 5rem); /* Even larger title */
    color: #dc143c;
    text-shadow: 0 0 30px rgba(220, 20, 60, 1), 0 0 60px rgba(0, 0, 0, 1); /* More intense title glow */
    margin-bottom: 1.5rem;
    letter-spacing: 4px;
    text-transform: uppercase;
    animation: pulse-red 2s infinite alternate; /* Title pulsates with color */
}

.failure-content-grid {
    display: grid;
    grid-template-columns: 1fr; /* Default to a single column for mobile */
    align-items: center;
    gap: 2.5rem; /* Space between elements when stacked */
    max-width: 1400px; /* Allow for a wider, more epic layout */
    width: 100%;
    margin-bottom: 3rem;
    justify-items: center; /* Center all items in the grid horizontally */
}

.failure-message-column {
    display: flex; /* Use flexbox for alignment */
    justify-content: center; /* Center align by default */
    height: 100%;
    padding: 0 1rem;
}

.failure-image-container {
    animation: bounce-in 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
.failure-image-container img {
    width: clamp(200px, 25vw, 380px);
    height: auto;
    filter: drop-shadow(0 0 50px rgba(220, 20, 60, 1));
    opacity: 0.98;
}

/* Runic Text Styles */
.rune-text-left, .rune-text-right {
    font-family: 'Times New Roman', Times, serif; /* Classic, readable, and ominous font */
    letter-spacing: 2px;
    text-transform: none; /* Normal casing for better readability */
    word-spacing: 2px; 
    line-height: 2; /* Slightly tighter for better block appearance */
    filter: blur(0.2px) brightness(1.2);
    color: #ffc0cb; /* A slightly softer, eerie glow */
    text-shadow: 0 0 5px rgba(255, 192, 203, 0.5), 0 0 10px rgba(255, 192, 203, 0.3), 1px 1px 2px #000;
}
.failure-prompt {
    font-family: 'Dancing Script', cursive; /* Can change this to be creepy too */
    font-size: clamp(1.3rem, 2.5vw, 1.8rem); /* Larger, more impactful prompt */
    color: #9370db; /* Medium purple */
    margin-top: 3rem;
    text-shadow: 0 0 15px rgba(147, 112, 219, 0.8), 0 0 5px rgba(0, 0, 0, 0.8);
    animation: pulse-red 1.2s infinite alternate-reverse; /* Slightly faster pulse */
    letter-spacing: 1px;
}

/* Responsive adjustments for the grid */
@media (max-width: 1024px) {
    .failure-message-column.right-column {
        display: none; /* Hide the second paragraph on small screens */
    }
    .rune-text-left, .rune-text-right {
        text-align: center; /* Center the text on mobile */
        transform: none; /* Remove the 3D tilt on mobile */
    }
}

/* Desktop layout adjustments */
@media (min-width: 1025px) {
    .failure-content-grid {
        grid-template-columns: 1fr auto 1fr; /* 3-column layout on desktop */
        gap: 3rem;
    }
    .rune-text-left { text-align: right; }
    .rune-text-right { text-align: left; }
}

/* =================================================================== */
/* END: REORGANIZED & RESPONSIVE INNER SANCTUM STYLES V2               */
/* =================================================================== */
/* --- ADD THIS: Guide Panel Layout --- */
#guide-panel {
    width: 100%;
    /* height: 100%; */ /* REMOVED: This was preventing the panel from scrolling. */
}
#guide-main-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto; /* Center the container like other panels. */
}


@media (max-width: 992px) {
    .main-content { padding: 100px 5vw 50px 5vw; } /* ALIGNMENT FIX: Symmetrical padding */
    .book-layout { grid-template-columns: 1fr; }
    .home-top-section, .home-bottom-section { padding-left: 20px; padding-right: 20px; }
}
@media (max-width: 768px) {
    .panel-header { font-size: 2.2rem; text-align: center; }
    .panel-subheader { text-align: center; }
    .main-content { padding: 90px 20px 30px 20px; }
    .planet-name-display { left: auto; right: 1rem; top: 1rem; transform: none; }
    .tome-title { font-size: 2.5rem; }
    .home-main-title { font-size: clamp(2.5em, 8vw, 4em); }
    .sacred-prophecy-quote { font-size: clamp(0.9em, 2.5vw, 1.2em); padding: 20px 30px; }
    .home-quote-box { padding: 15px 25px; }
    #chronicle-panel #star-info-box { bottom: 20px; opacity: 1; pointer-events: all; }
    #nebula-of-solitude .chapter { padding: 80px 20px; }
    #nebula-of-solitude .chapter-title { font-size: 36px; }
    #nebula-of-solitude .chapter-content { font-size: 16px; }
    #nebula-of-solitude .nav-orbit { right: 10px; }
    #nebula-of-solitude .planet-nav { width: 40px; height: 40px; margin: 15px 0; }
    #nebula-of-solitude .stats-dashboard { grid-template-columns: 1fr; }

    /* Improved mobile responsiveness for game halls */
    .halls-grid {
        grid-template-columns: 1fr;
        gap: 30px;
        padding: 20px;
    }
    .hall-card {
        width: 80vw;
        max-width: 280px;
        height: auto;
        margin: 0 auto;
    }
    .games-grid {
        grid-template-columns: 1fr;
    }
    .game-card {
        padding: 20px;
    }
    .panel-header {
        font-size: clamp(2rem, 8vw, 2.8rem);
    }

    /* Redesigned Sanctuary Mobile */
    #sanctuary-panel .title { font-size: 2.5em; }
    #sanctuary-panel .realm-grid, #sanctuary-panel .book-shelf { grid-template-columns: 1fr; }
    #sanctuary-panel .section-title::before, #sanctuary-panel .section-title::after { display: none; }
    #sanctuary-panel .choice-button { flex-basis: 100%; }
    #sanctuary-panel .subtitle, #sanctuary-panel .prophecy-text { text-align: center; }
    #sanctuary-panel .question-box { text-align: center; }
    #sanctuary-panel .sacred-scroll { padding: 30px; }
    #sanctuary-panel .enter-button:hover { transform: translate(-50%, -50%) scale(1.05); }
    #sanctuary-panel .modal-content { padding: 30px 20px; }
    #sanctuary-panel .modal-title { font-size: 2.2em; }
}
/* --- ADD THIS: Responsive Menu Button --- */
@media (max-width: 768px) {
    #main-menu-button {
        width: 60px;
        height: 60px;
        padding: 4px; /* Adjust padding for smaller button */
    }
    #main-menu-container.ready-to-drag::after {
        font-size: 0.8rem;
        padding: 6px 10px;
        bottom: -30px; /* Adjust position for smaller button */
        bottom: var(--tooltip-bottom, -30px);
    }
    /* --- ADD THIS: Make dropdown content smaller on mobile --- */
    #main-menu-dropdown {
        width: 190px; /* Further reduce width to better fit content */
        padding: 8px;
    }
    #main-menu-dropdown a {
        font-size: 1rem; /* Reduce font size from 1.1rem */
        padding: 10px 12px; /* Reduce padding */
    }
    /* --- ADD THIS: Make  buttons smaller on mobile --- */
    .theme-colors-grid {
        grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
        gap: 8px;
    }
}

/* --- ADD THIS: Further reduce menu button size on very small screens --- */
@media (max-width: 480px) {
    #main-menu-container {
        top: 70px;
        left: 10px;
    }
    #main-menu-button {
        width: 44px;
        height: 44px;
        padding: 3px;
    }
    /* --- ADD THIS: Further reduce theme button size on very small screens --- */
    .theme-colors-grid {
        grid-template-columns: repeat(auto-fit, minmax(44px, 1fr));
        gap: 6px;
    }
}

#sanctuary-main-container.scrollable-content {
    align-items: flex-start; /* Align content to the top */
    padding-top: 80px; /* Add top padding to push content down */
    padding-bottom: 40px; /* Add bottom padding */
}
/* --- ADD THIS: Center Guide Panel content like Sanctuary Panel --- */

/* =================================================================== */
/* START: CONSTELLATION GUIDE REDESIGN - ASTRAL LIBRARY OF MEMORIES    */
/* =================================================================== */
/* Shuffling Animations */
@keyframes shuffle1 {
    0%, 100% { top: 10%; left: 15%; transform: rotate(-5deg) scale(0.9); z-index: 1; }
    25% { top: 50%; left: 60%; transform: rotate(10deg) scale(1); z-index: 3; }
    50% { top: 20%; left: 80%; transform: rotate(-10deg) scale(0.8); z-index: 0; }
    75% { top: 60%; left: 20%; transform: rotate(5deg) scale(0.95); z-index: 2; }
}

@keyframes shuffle2 {
    0%, 100% { top: 20%; left: 80%; transform: rotate(-10deg) scale(0.8); z-index: 0; }
    25% { top: 60%; left: 20%; transform: rotate(5deg) scale(0.95); z-index: 2; }
    50% { top: 10%; left: 15%; transform: rotate(-5deg) scale(0.9); z-index: 1; }
    75% { top: 50%; left: 60%; transform: rotate(10deg) scale(1); z-index: 3; }
}

@keyframes shuffle3 {
    0%, 100% { top: 50%; left: 60%; transform: rotate(10deg) scale(1); z-index: 3; }
    25% { top: 20%; left: 80%; transform: rotate(-10deg) scale(0.8); z-index: 0; }
    50% { top: 60%; left: 20%; transform: rotate(5deg) scale(0.95); z-index: 2; }
    75% { top: 10%; left: 15%; transform: rotate(-5deg) scale(0.9); z-index: 1; }
}

@keyframes shuffle4 {
    0%, 100% { top: 60%; left: 20%; transform: rotate(5deg) scale(0.95); z-index: 2; }
    25% { top: 10%; left: 15%; transform: rotate(-5deg) scale(0.9); z-index: 1; }
    50% { top: 50%; left: 60%; transform: rotate(10deg) scale(1); z-index: 3; }
    75% { top: 20%; left: 80%; transform: rotate(-10deg) scale(0.8); z-index: 0; }
}

@keyframes shuffle5 {
    0%, 100% { top: 40%; left: 5%; transform: rotate(8deg) scale(0.85); z-index: 0; }
    25% { top: 10%; left: 45%; transform: rotate(-8deg) scale(1); z-index: 3; }
    50% { top: 55%; left: 75%; transform: rotate(12deg) scale(0.9); z-index: 1; }
    75% { top: 70%; left: 40%; transform: rotate(-12deg) scale(0.95); z-index: 2; }
}

@keyframes shuffle6 {
    0%, 100% { top: 10%; left: 45%; transform: rotate(-8deg) scale(1); z-index: 3; }
    25% { top: 55%; left: 75%; transform: rotate(12deg) scale(0.9); z-index: 1; }
    50% { top: 70%; left: 40%; transform: rotate(-12deg) scale(0.95); z-index: 2; }
    75% { top: 40%; left: 5%; transform: rotate(8deg) scale(0.85); z-index: 0; }
}

/* --- ADD THIS: Guide Entrance Animation --- */
#guide-entrance-animation .door-image {
    width: clamp(250px, 40vw, 400px);
    aspect-ratio: 1 / 1;
    margin: 0 auto;
    filter: drop-shadow(0 0 15px var(--gold)) drop-shadow(0 0 25px var(--soft-violet));
    transition: transform 1.5s ease-in-out, opacity 1.5s ease-in-out;
}
#guide-entrance-animation.is-opening .door-image { transform: scale(5); opacity: 0; }
/* =================================================================== */
/* =================================================================== */
/* END: CONSTELLATION GUIDE REDESIGN                                   */
/* =================================================================== */

/* ADD these styles to the Inner Sanctum section of styles.css */

/* --- Keyframe for Blinking Cursor and Shaking --- */
@keyframes blink-caret {
    from, to { border-color: transparent; }
    50% { border-color: var(--gold); }
}
@keyframes shake-error-anim {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-8px); }
    75% { transform: translateX(8px); }
}

/* --- Entrance Styles Enhancements --- */
#sanctuary-entrance {
    /* Existing styles are fine, just ensure it's a flex container */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 1s ease-in-out;
}

.sanctuary-intro {
    font-family: var(--font-handwriting);
    font-size: clamp(1.2em, 2vw, 1.6em);
    color: var(--gold-light);
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    max-width: 600px;
    margin-top: 2rem;
    line-height: 1.8;
    min-height: 140px; /* Reserve space to prevent layout shift */
}

.sanctuary-intro.typing {
    border-right: .15em solid var(--gold);
    animation: blink-caret .75s step-end infinite;
}

.sanctuary-challenge-container {
    margin-top: 2rem;
    width: 100%;
    max-width: 500px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.sanctuary-challenge-container.shake-error {
    animation: shake-error-anim 0.5s ease-in-out;
}

.challenge-feedback {
    min-height: 1.2em;
    font-style: italic;
    font-weight: bold;
    transition: color 0.3s;
}

.challenge-input-group {
    display: flex;
    width: 100%;
    gap: 10px;
}

#sanctuary-password {
    flex-grow: 1;
    text-align: center;
    font-size: 1.2rem;
}

.challenge-separator {
    font-family: var(--font-display);
    color: var(--text-secondary);
}

#sanctuary-question-choices {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
}

.choice-button {
    background: transparent;
    border-color: var(--soft-violet);
    color: var(--soft-violet);
}
.choice-button:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: var(--gold);
    color: var(--gold);
}

/* MODIFIED Door Opening Animation */
#sanctuary-entrance.is-opening {
    pointer-events: none; /* Prevent clicks during animation */
}
#sanctuary-entrance.is-opening #sanctuary-door-container {
    transform: scale(5); /* Controls the zoom level */
    opacity: 0;
}
#sanctuary-entrance.is-opening #closed-door-img {
    opacity: 0;
}
#sanctuary-entrance.is-opening #open-door-img {
    opacity: 1;
}
#sanctuary-entrance.is-opening .sanctuary-intro,
#sanctuary-entrance.is-opening .sanctuary-challenge-container {
    opacity: 0;
    transition: opacity 0.5s ease;
}

/* ============================================= */
/* NEW FEATURES STYLES - 7 FEATURES             */
/* ============================================= */

/* ===== MOOD SYNC BAR ===== */
#mood-sync-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(90deg, 
        var(--deep-purple) 0%, 
        var(--space-black) 50%, 
        var(--deep-purple) 100%);
    border-bottom: 1px solid var(--gold);
    z-index: 9000;
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.5);
    transition: top 0.4s ease-in-out;
}

#mood-sync-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    height: 50px;
}

/* Collapsed state */
#mood-sync-bar.collapsed {
    top: -50px;
}

#mood-sync-visibility-toggle {
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 25px;
    background: var(--deep-purple);
    border: 1px solid var(--gold);
    border-top: none;
    border-radius: 0 0 10px 10px;
    color: var(--gold);
    cursor: pointer;
    font-size: 1rem;
    line-height: 1;
    transition: background 0.3s;
}

#mood-sync-visibility-toggle:hover {
    background: var(--soft-violet);
}

#mood-sync-visibility-toggle span {
    display: inline-block;
    transition: transform 0.4s ease-in-out;
}

.mood-selector {
    display: flex;
    align-items: center;
    gap: 10px;
}

.mood-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-family: var(--font-display);
}

.mood-picker-dropdown {
    position: relative;
}

.current-mood-btn {
    background: rgba(255, 215, 0, 0.1);
    border: 1px solid var(--gold);
    border-radius: 20px;
    padding: 8px 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: var(--transition-fast);
    font-family: var(--font-body);
    color: var(--gold-light);
}

.current-mood-btn:hover {
    background: rgba(255, 215, 0, 0.2);
    transform: scale(1.05);
}

.mood-emoji {
    font-size: 1.4rem;
}

.mood-name {
    font-size: 0.95rem;
}

.mood-options {
    position: absolute;
    top: calc(100% + 5px);
    left: 0;
    background: var(--deep-purple);
    border: 1px solid var(--gold);
    border-radius: 8px;
    padding: 8px;
    display: none;
    flex-direction: column;
    gap: 4px;
    min-width: 160px;
    z-index: 9001;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
}

.mood-options.active {
    display: flex;
}

.mood-option {
    padding: 10px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: var(--transition-fast);
    color: var(--text-primary);
    font-size: 1rem;
}

.mood-option:hover {
    background: rgba(255, 215, 0, 0.2);
    transform: translateX(5px);
}

.mood-center {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
}

.combined-mood-display {
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: var(--font-handwriting);
    color: var(--gold-light);
    font-size: 1.2rem;
}

/* Visual state when Mood Sync is disabled */
#mood-sync-bar.mood-sync-disabled {
    opacity: 0.65;
}
#mood-sync-bar.mood-sync-disabled .combined-mood-display {
    opacity: 0.6;
}

.combined-icon {
    font-size: 1.8rem;
    animation: pulse-glow 2s infinite;
}

.combined-text {
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

#mood-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    opacity: 0.6;
}

.mood-popup {
    position: fixed;
    top: 60px;
    right: 20px;
    z-index: 9002;
    display: none;
    animation: slideInRight 0.5s ease-out;
}

.mood-popup.active {
    display: block;
}

@keyframes slideInRight {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.mood-popup-content {
    background: var(--deep-purple);
    border: 2px solid var(--gold);
    border-radius: 12px;
    padding: 20px;
    max-width: 300px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    position: relative;
}

.mood-popup-close {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition-fast);
}

.mood-popup-close:hover {
    color: var(--gold);
}

.mood-popup-icon {
    font-size: 3rem;
    text-align: center;
    margin-bottom: 10px;
}

.mood-popup-title {
    font-family: var(--font-display);
    color: var(--gold);
    text-align: center;
    margin-bottom: 10px;
}

.mood-popup-message {
    color: var(--text-primary);
    text-align: center;
    margin-bottom: 15px;
    line-height: 1.6;
}

.mood-popup-action {
    width: 100%;
}

/* Adjust main content to account for mood bar */
#celestial-sanctuary {
    padding-top: 0; /* The bar is an overlay now */
}


/* ===== TIME CAPSULE STYLES ===== */
.time-vault-container {
    min-height: 80vh;
    position: relative;
}

.capsule-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: var(--highlight-glass);
    border-radius: 12px;
    border: 1px solid var(--border-glass);
}

.stat-item {
    text-align: center;
}

.stat-number {
    font-family: var(--font-display);
    font-size: 2.5rem;
    color: var(--gold);
    text-shadow: 0 0 10px var(--gold);
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 5px;
}

.capsule-orbit-view {
    position: relative;
    height: 500px;
    background: radial-gradient(circle at center, rgba(74, 14, 78, 0.3), transparent);
    border-radius: 15px;
    margin: 2rem 0;
}

.central-void {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: radial-gradient(circle, #000, var(--deep-purple));
    border-radius: 50%;
    box-shadow: 0 0 30px var(--soft-violet), inset 0 0 20px #000;
}

.capsule-item {
    position: absolute;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    cursor: pointer;
    transition: var(--transition-fast);
    animation: float 3s ease-in-out infinite;
}

.capsule-item:hover {
    transform: scale(1.3);
    z-index: 10;
}

.capsule-item.sealed {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    box-shadow: 0 0 20px #FFD700;
}

.capsule-item.unlocked {
    background: linear-gradient(135deg, #FFFFFF, #C0C0C0);
    box-shadow: 0 0 20px #FFFFFF;
    animation: pulse-glow 2s infinite;
}

.capsule-item.mood-locked {
    background: linear-gradient(135deg, #9370DB, #8A2BE2);
    box-shadow: 0 0 20px #9370DB;
}

.capsule-preview-tooltip {
    position: fixed;
    background: rgba(17, 12, 31, 0.95);
    border: 2px solid var(--gold);
    border-radius: 8px;
    padding: 15px;
    max-width: 300px;
    pointer-events: none;
    z-index: 10000;
    display: none;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
}

.capsule-preview-tooltip.active {
    display: block;
}

.tooltip-from { color: var(--text-secondary); font-size: 0.85rem; }
.tooltip-title { color: var(--gold); font-size: 1.1rem; margin: 5px 0; }
.tooltip-date { color: var(--glow-cyan); font-size: 0.9rem; }
.tooltip-countdown { color: var(--soft-violet); font-size: 0.85rem; margin-top: 5px; }

/* Capsule Modal */
.capsule-modal {
    position: fixed;
    inset: 0;
    background: rgba(2, 4, 27, 0.9);
    backdrop-filter: blur(10px);
    z-index: 10001;
    display: none;
    align-items: center;
    justify-content: center;
}

.capsule-modal.active {
    display: flex;
}

.capsule-modal-content {
    background: var(--deep-purple);
    border: 3px solid var(--gold);
    border-radius: 15px;
    padding: 2.5rem;
    max-width: 700px;
    width: 90%;
    max-height: 85vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
}

.capsule-form-step {
    display: none;
}

.capsule-form-step.active {
    display: block;
    animation: fade-in-up 0.5s;
}

.step-header {
    font-family: var(--font-display);
    color: var(--gold);
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    text-align: center;
}

.step-description {
    color: var(--text-secondary);
    text-align: center;
    margin-bottom: 2rem;
}

.recipient-options, .unlock-condition-options {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.option-btn {
    padding: 15px 25px;
    background: transparent;
    border: 2px solid var(--soft-violet);
    border-radius: 8px;
    color: var(--gold-light);
    cursor: pointer;
    transition: var(--transition-fast);
    font-family: var(--font-body);
    font-size: 1rem;
}

.option-btn:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: var(--gold);
}

/* ============================================= */
/* NEW FEATURES STYLES - 7 FEATURES             */
/* ============================================= */

.mood-selector {
    display: flex;
    align-items: center;
    gap: 10px;
}

.mood-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-family: var(--font-display);
}

.mood-picker-dropdown {
    position: relative;
}

.current-mood-btn {
    background: rgba(255, 215, 0, 0.1);
    border: 1px solid var(--gold);
    border-radius: 20px;
    padding: 8px 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: var(--transition-fast);
    font-family: var(--font-body);
    color: var(--gold-light);
}

.current-mood-btn:hover {
    background: rgba(255, 215, 0, 0.2);
    transform: scale(1.05);
}

.mood-emoji {
    font-size: 1.4rem;
}

.mood-name {
    font-size: 0.95rem;
}

.mood-options {
    position: absolute;
    top: calc(100% + 5px);
    left: 0;
    background: var(--deep-purple);
    border: 1px solid var(--gold);
    border-radius: 8px;
    padding: 8px;
    display: none;
    flex-direction: column;
    gap: 4px;
    min-width: 160px;
    z-index: 9001;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    
}

.mood-options.active {
    display: flex;
}

.mood-option {
    background: var(--deep-purple);
    padding: 10px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: var(--transition-fast);
    color: var(--text-primary);
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.mood-option:hover {
    background: rgba(255, 215, 0, 0.2);
    transform: translateX(5px);
}

.mood-center {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
}

.combined-mood-display {
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: var(--font-handwriting);
    color: var(--gold-light);
    font-size: 1.2rem;
}

.combined-icon {
    font-size: 1.8rem;
    animation: pulse-glow 2s infinite;
}

.combined-text {
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

#mood-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    opacity: 0.6;
}

.mood-popup {
    position: fixed;
    top: 60px;
    right: 20px;
    z-index: 9002;
    display: none;
    animation: slideInRight 0.5s ease-out;
}

.mood-popup.active {
    display: block;
}

@keyframes slideInRight {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.mood-popup-content {
    background: var(--deep-purple);
    border: 2px solid var(--gold);
    border-radius: 12px;
    padding: 20px;
    max-width: 300px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    position: relative;
}

.mood-popup-close {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition-fast);
}

.mood-popup-close:hover {
    color: var(--gold);
}

.mood-popup-icon {
    font-size: 3rem;
    text-align: center;
    margin-bottom: 10px;
}

.mood-popup-title {
    font-family: var(--font-display);
    color: var(--gold);
    text-align: center;
    margin-bottom: 10px;
}

.mood-popup-message {
    color: var(--text-primary);
    text-align: center;
    margin-bottom: 15px;
    line-height: 1.6;
}

.mood-popup-action {
    width: 100%;
}

/* Adjust main content to account for mood bar */
#celestial-sanctuary {
    padding-top: 50px;
    height: calc(100vh - 50px);
}

.main-content {
    padding-top: 50px !important; /* Account for mood bar + original padding */
}


/* ===== TIME CAPSULE STYLES ===== */
.time-vault-container {
    min-height: 80vh;
    position: relative;
}

.capsule-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: var(--highlight-glass);
    border-radius: 12px;
    border: 1px solid var(--border-glass);
}

.stat-item {
    text-align: center;
}

.stat-number {
    font-family: var(--font-display);
    font-size: 2.5rem;
    color: var(--gold);
    text-shadow: 0 0 10px var(--gold);
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 5px;
}

.capsule-orbit-view {
    position: relative;
    height: 500px;
    background: radial-gradient(circle at center, rgba(74, 14, 78, 0.3), transparent);
    border-radius: 15px;
    margin: 2rem 0;
}

.central-void {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: radial-gradient(circle, #000, var(--deep-purple));
    border-radius: 50%;
    box-shadow: 0 0 30px var(--soft-violet), inset 0 0 20px #000;
}

.capsule-item {
    position: absolute;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    cursor: pointer;
    transition: var(--transition-fast);
    animation: float 3s ease-in-out infinite;
}

.capsule-item:hover {
    transform: scale(1.3);
    z-index: 10;
}

.capsule-item.sealed {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    box-shadow: 0 0 20px #FFD700;
}

.capsule-item.unlocked {
    background: linear-gradient(135deg, #FFFFFF, #C0C0C0);
    box-shadow: 0 0 20px #FFFFFF;
    animation: pulse-glow 2s infinite;
}

.capsule-item.mood-locked {
    background: linear-gradient(135deg, #9370DB, #8A2BE2);
    box-shadow: 0 0 20px #9370DB;
}

.capsule-preview-tooltip {
    position: fixed;
    background: rgba(17, 12, 31, 0.95);
    border: 2px solid var(--gold);
    border-radius: 8px;
    padding: 15px;
    max-width: 300px;
    pointer-events: none;
    z-index: 10000;
    display: none;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
}

.capsule-preview-tooltip.active {
    display: block;
}

.tooltip-from { color: var(--text-secondary); font-size: 0.85rem; }
.tooltip-title { color: var(--gold); font-size: 1.1rem; margin: 5px 0; }
.tooltip-date { color: var(--glow-cyan); font-size: 0.9rem; }
.tooltip-countdown { color: var(--soft-violet); font-size: 0.85rem; margin-top: 5px; }

/* Capsule Modal */
.capsule-modal {
    position: fixed;
    inset: 0;
    background: rgba(2, 4, 27, 0.9);
    backdrop-filter: blur(10px);
    z-index: 10001;
    display: none;
    align-items: center;
    justify-content: center;
}

.capsule-modal.active {
    display: flex;
}

.capsule-modal-content {
    background: var(--deep-purple);
    border: 3px solid var(--gold);
    border-radius: 15px;
    padding: 2.5rem;
    max-width: 700px;
    width: 90%;
    max-height: 85vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
}

.capsule-form-step {
    display: none;
}

.capsule-form-step.active {
    display: block;
    animation: fade-in-up 0.5s;
}

.step-header {
    font-family: var(--font-display);
    color: var(--gold);
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    text-align: center;
}

.step-description {
    color: var(--text-secondary);
    text-align: center;
    margin-bottom: 2rem;
}

.recipient-options, .unlock-condition-options {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.option-btn {
    padding: 15px 25px;
    background: transparent;
    border: 2px solid var(--soft-violet);
    border-radius: 8px;
    color: var(--gold-light);
    cursor: pointer;
    transition: var(--transition-fast);
    font-family: var(--font-body);
    font-size: 1rem;
}

.option-btn:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: var(--gold);
}

/* =================================================================== */
/* START: CONSTELLATION GUIDE REDESIGN - ASTRAL LIBRARY OF MEMORIES    */
/* =================================================================== */

/* --- Main Guide Panel Container --- */
#guide-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100%;
    width: 100%;
    padding: 2rem;
    box-sizing: border-box;
}

/* --- Portal Hub View --- */
.portal-hub-view {
    width: 100%;
    max-width: 1400px;
    text-align: center;
}

.celestial-card-shrine {
    position: relative;
    width: 100%;
    height: 550px;
    margin-top: 3rem;
    perspective: 1500px;
}

.celestial-card {
    position: relative;
    width: 220px;
    height: 320px;
    background: rgba(138, 43, 226, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 15px;
    backdrop-filter: blur(10px);
    cursor: pointer;
    transition: transform 0.5s ease, box-shadow 0.5s ease, border-color 0.5s ease;
    transform-style: preserve-3d;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.4), inset 0 0 15px rgba(138, 43, 226, 0.2);
    position: absolute;
    animation-duration: 20s;
    animation-timing-function: ease-in-out;
    animation-iteration-count: infinite;
}

.celestial-card:hover {
    transform: translateY(-15px) scale(1.1) rotateY(5deg) !important; /* Use important to override animation transform */
    box-shadow: 0 15px 40px rgba(0,0,0,0.6), 0 0 25px var(--gold);
    border-color: var(--gold);
    animation-play-state: paused;
}

.celestial-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 15px;
    background: url('https://www.transparenttextures.com/patterns/stardust.png');
    opacity: 0.1;
    z-index: -1;
}

.card-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    text-shadow: 0 0 15px var(--gold);
    transition: text-shadow 0.5s ease;
}

.celestial-card:hover .card-icon {
    text-shadow: 0 0 25px var(--gold), 0 0 40px var(--soft-violet);
}

.card-label {
    font-family: var(--font-display);
    font-size: 1.4rem;
    color: var(--gold-light);
    transition: color 0.5s ease;
}

.celestial-card:hover .card-label {
    color: var(--gold);
}

/* Shuffling Animations */
@keyframes shuffle1 {
    0%, 100% { top: 10%; left: 15%; transform: rotate(-5deg) scale(0.9); z-index: 1; }
    25% { top: 50%; left: 60%; transform: rotate(10deg) scale(1); z-index: 3; }
    50% { top: 20%; left: 80%; transform: rotate(-10deg) scale(0.8); z-index: 0; }
    75% { top: 60%; left: 20%; transform: rotate(5deg) scale(0.95); z-index: 2; }
}

@keyframes shuffle2 {
    0%, 100% { top: 20%; left: 80%; transform: rotate(-10deg) scale(0.8); z-index: 0; }
    25% { top: 60%; left: 20%; transform: rotate(5deg) scale(0.95); z-index: 2; }
    50% { top: 10%; left: 15%; transform: rotate(-5deg) scale(0.9); z-index: 1; }
    75% { top: 50%; left: 60%; transform: rotate(10deg) scale(1); z-index: 3; }
}

@keyframes shuffle3 {
    0%, 100% { top: 50%; left: 60%; transform: rotate(10deg) scale(1); z-index: 3; }
    25% { top: 20%; left: 80%; transform: rotate(-10deg) scale(0.8); z-index: 0; }
    50% { top: 60%; left: 20%; transform: rotate(5deg) scale(0.95); z-index: 2; }
    75% { top: 10%; left: 15%; transform: rotate(-5deg) scale(0.9); z-index: 1; }
}

@keyframes shuffle4 {
    0%, 100% { top: 60%; left: 20%; transform: rotate(5deg) scale(0.95); z-index: 2; }
    25% { top: 10%; left: 15%; transform: rotate(-5deg) scale(0.9); z-index: 1; }
    50% { top: 50%; left: 60%; transform: rotate(10deg) scale(1); z-index: 3; }
    75% { top: 20%; left: 80%; transform: rotate(-10deg) scale(0.8); z-index: 0; }
}

@keyframes shuffle5 {
    0%, 100% { top: 40%; left: 5%; transform: rotate(8deg) scale(0.85); z-index: 0; }
    25% { top: 10%; left: 45%; transform: rotate(-8deg) scale(1); z-index: 3; }
    50% { top: 55%; left: 75%; transform: rotate(12deg) scale(0.9); z-index: 1; }
    75% { top: 70%; left: 40%; transform: rotate(-12deg) scale(0.95); z-index: 2; }
}

@keyframes shuffle6 {
    0%, 100% { top: 10%; left: 45%; transform: rotate(-8deg) scale(1); z-index: 3; }
    25% { top: 55%; left: 75%; transform: rotate(12deg) scale(0.9); z-index: 1; }
    50% { top: 70%; left: 40%; transform: rotate(-12deg) scale(0.95); z-index: 2; }
    75% { top: 40%; left: 5%; transform: rotate(8deg) scale(0.85); z-index: 0; }
}

/* --- Individual Section Views (Placeholder) --- */
.guide-section-view {
    display: none; /* Hidden by default */
    width: 100%;
    animation: fade-in-up 0.8s ease;
}
.guide-section-view.active {
    display: block;
}
.back-to-hub-btn {
    display: block;
    margin: 0 auto 2rem auto;
    width: fit-content;
}

@media (max-width: 992px) {
    .celestial-card-shrine {
        height: 700px; /* More vertical space on tablets */
    }
}

@media (max-width: 600px) {
    .celestial-card-shrine {
        height: 800px; /* Even more vertical space on mobile */
        margin-top: 1rem;
    }
    .celestial-card {
        width: 180px;
        height: 260px;
        margin: 0 auto;
    }
}

/* =================================================================== */
/* END: CONSTELLATION GUIDE REDESIGN                                   */
/* =================================================================== */


.option-btn.selected {
    background: rgba(255, 215, 0, 0.2);
    border-color: var(--gold);
    color: var(--gold);
}

.conditional-input {
    display: none;
    margin-top: 1rem;
}

.conditional-input.active {
    display: block;
}

.form-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
}

/* Unlock Animation */
.unlock-ceremony {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.95);
    z-index: 10002;
    display: none;
    align-items: center;
    justify-content: center;
}

.unlock-ceremony.active {
    display: flex;
}

.unlock-animation {
    text-align: center;
}

.unlock-capsule-icon {
    font-size: 8rem;
    animation: capsule-crack 2s ease-out;
}

@keyframes capsule-crack {
    0% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.2) rotate(10deg); }
    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
}

.unlock-countdown {
    font-family: var(--font-display);
    font-size: 4rem;
    color: var(--gold);
    text-shadow: 0 0 30px var(--gold);
    margin-top: 20px;
}


/* ===== RECIPE COSMOS STYLES ===== */
.recipe-cosmos-container {
    max-width: 1400px;
    margin: 0 auto;
}

.recipe-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    justify-content: center;
}

.recipe-filters {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 2rem;
    justify-content: center;
}

.filter-tag {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid var(--soft-violet);
    border-radius: 20px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.9rem;
}

.filter-tag:hover {
    border-color: var(--gold);
    color: var(--gold);
}

.filter-tag.active {
    background: rgba(255, 215, 0, 0.2);
    border-color: var(--gold);
    color: var(--gold);
}

.recipe-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.recipe-card {
    background: var(--highlight-glass);
    border: 1px solid var(--border-glass);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: var(--transition-fast);
}

.recipe-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border-color: var(--gold);
}

.recipe-card-image {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-bottom: 2px solid var(--gold);
}

.recipe-card-content {
    padding: 1.5rem;
}

.recipe-card-title {
    font-family: var(--font-display);
    color: var(--gold);
    font-size: 1.4rem;
    margin-bottom: 0.5rem;
}

.recipe-card-stats {
    display: flex;
    gap: 1rem;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
}

.recipe-rating {
    color: var(--gold);
}

/* Recipe Detail View */
.recipe-detail-view {
    max-width: 900px;
    margin: 0 auto;
}

.recipe-photo-gallery {
    position: relative;
    margin-bottom: 2rem;
}

.recipe-main-photo {
    width: 100%;
    height: 400px;
    object-fit: cover;
    border-radius: 12px;
    border: 2px solid var(--gold);
}

.recipe-thumbnails {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    overflow-x: auto;
    padding: 10px 0;
}

.recipe-thumbnail {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid var(--border-glass);
    cursor: pointer;
    transition: var(--transition-fast);
    flex-shrink: 0;
}

.recipe-thumbnail:hover, .recipe-thumbnail.active {
    border-color: var(--gold);
    transform: scale(1.1);
}

.recipe-story {
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid var(--gold);
    margin-bottom: 2rem;
}

.recipe-story h3 {
    font-family: var(--font-display);
    color: var(--gold);
    margin-bottom: 1rem;
}

.recipe-meta {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.meta-item {
    text-align: center;
    padding: 1rem;
    background: var(--highlight-glass);
    border-radius: 8px;
}

.meta-label {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.meta-value {
    color: var(--gold);
    font-size: 1.3rem;
    font-family: var(--font-display);
}

.recipe-ingredients {
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
}

.recipe-ingredients h3 {
    font-family: var(--font-display);
    color: var(--gold);
    margin-bottom: 1rem;
}

.ingredient-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    border-bottom: 1px solid var(--border-glass);
}

.ingredient-item:last-child {
    border-bottom: none;
}

.ingredient-checkbox {
    width: 20px;
    height: 20px;
}

.ingredient-photo-thumb {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border-radius: 4px;
}

.recipe-instructions {
    margin-bottom: 2rem;
}

.instruction-step {
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    border-left: 4px solid var(--soft-violet);
}

.step-number {
    font-family: var(--font-display);
    font-size: 2rem;
    color: var(--gold);
    margin-bottom: 0.5rem;
}

.step-photo {
    width: 100%;
    max-width: 400px;
    height: auto;
    border-radius: 8px;
    margin: 1rem 0;
}

.step-timer-btn {
    margin-top: 0.5rem;
}

.step-tip {
    background: rgba(255, 215, 0, 0.1);
    padding: 10px;
    border-radius: 6px;
    border-left: 3px solid var(--gold);
    margin-top: 1rem;
    font-style: italic;
}

.recipe-rating-section {
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 12px;
    border: 2px solid var(--gold);
    margin-bottom: 2rem;
}

.rating-stars {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.rating-category {
    flex: 1;
}

.rating-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.stars {
    color: var(--gold);
    font-size: 1.5rem;
}

.nic-review {
    background: rgba(255, 215, 0, 0.1);
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid var(--gold);
}

.review-text {
    font-style: italic;
    color: var(--gold-light);
    line-height: 1.8;
    margin-bottom: 1rem;
}

.review-author {
    color: var(--text-secondary);
    text-align: right;
}


/* ===== VOICE GARDEN STYLES ===== */
.voice-garden-container {
    position: relative;
    min-height: 600px;
}

.garden-stats-bar {
    display: flex;
    justify-content: space-around;
    padding: 1rem;
    background: var(--highlight-glass);
    border-radius: 8px;
    margin-bottom: 2rem;
}

.garden-stat {
    text-align: center;
}

.stat-value {
    font-size: 1.8rem;
    color: var(--gold);
    font-family: var(--font-display);
}

.stat-desc {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.garden-view {
    position: relative;
    min-height: 500px;
    background: linear-gradient(to bottom, #0a0f1e 0%, #1a2a3a 100%);
    border-radius: 15px;
    border: 2px solid var(--border-glass);
    padding: 2rem;
    overflow: hidden;
}

.garden-ground {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 100px;
    background: linear-gradient(to top, #2d1810, transparent);
}

.garden-flower {
    position: absolute;
    cursor: pointer;
    transition: var(--transition-fast);
    animation: float 4s ease-in-out infinite;
}

.flower-icon {
    font-size: 3rem;
    filter: drop-shadow(0 0 10px currentColor);
}

.garden-flower:hover .flower-icon {
    transform: scale(1.3);
    filter: drop-shadow(0 0 20px currentColor);
}

.flower-stem {
    width: 4px;
    height: 40px;
    background: #2d5016;
    margin: 0 auto;
}
.flower-unheard {
    animation: pulse-glow 2s infinite, float 4s ease-in-out infinite;
}

.voice-playback-modal {
    position: fixed;
    background: rgba(2, 4, 27, 0.7);
    backdrop-filter: blur(8px);
    z-index: 9000;
    display: none;
    align-items: center;
    justify-content: center;
    inset: 0;
    padding: 20px; /* Added padding for small screens */
}

.voice-playback-modal.active {
    display: flex;
    animation: fade-in 0.5s;
}

.voice-playback-content {
    background: var(--deep-purple);
    border: 2px solid var(--gold);
    border-radius: 15px;
    padding: 20px;
    width: 350px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    position: relative;
    animation: fade-in-up 0.5s;
}

.playback-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.playback-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition-fast);
}
.playback-close:hover {
    color: var(--gold);
    transform: rotate(90deg);
}

.waveform-container {
    height: 80px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.waveform-bar {
    width: 3px;
    background: var(--gold);
    margin: 0 2px;
    border-radius: 2px;
    transition: height 0.1s;
}

.playback-progress {
    width: 100%;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    margin-bottom: 10px;
    cursor: pointer;
    position: relative;
}

.playback-progress-fill {
    height: 100%;
    background: var(--gold);
    border-radius: 3px;
    width: 0%;
    transition: width 0.1s;
}

.playback-time {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-bottom: 15px;
}

.playback-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
}

.playback-btn {
    background: none;
    border: none;
    color: var(--gold);
    font-size: 1.8rem;
    cursor: pointer;
    transition: var(--transition-fast);
}

.playback-btn:hover {
    color: var(--gold-light);
    transform: scale(1.1);
}

.playback-metadata {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border-glass);
}

.metadata-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.metadata-label {
    color: var(--text-secondary);
}

.metadata-value {
    color: var(--gold-light);
}

.voice-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.voice-action-btn {
    flex: 1;
    padding: 10px;
    background: transparent;
    border: 1px solid var(--soft-violet);
    border-radius: 6px;
    color: var(--gold-light);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.9rem;
}

.voice-action-btn:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: var(--gold);
}

/* Voice Garden: language filter buttons (English / Chinese / All) */
.voice-garden-container .filter-buttons {
    display: flex;
    gap: 8px;
    margin-top: 6px;
    align-items: center;
}
.vg-filter {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid var(--border-glass);
    background: transparent;
    color: var(--gold-light);
    cursor: pointer;
    font-family: var(--font-display);
    font-size: 0.95rem;
    transition: var(--transition-fast);
    box-shadow: 0 4px 10px rgba(0,0,0,0.35);
}
.vg-filter:hover {
    background: rgba(255,215,0,0.06);
    color: var(--gold);
    transform: translateY(-2px);
}
.vg-filter:focus {
    outline: 2px solid rgba(100,255,218,0.12);
    outline-offset: 2px;
}
.vg-filter.active {
    background: linear-gradient(90deg, rgba(255,215,0,0.12), rgba(138,43,226,0.08));
    color: var(--deep-purple);
    border-color: var(--gold);
    box-shadow: 0 8px 25px rgba(255,215,0,0.08);
    font-weight: 600;
}

@media (max-width: 768px) {
    .voice-garden-container .filter-buttons { gap: 6px; }
    .vg-filter { padding: 6px 10px; font-size: 0.9rem; }
}

    /* Voice Garden badges (favorite and emoji) */
    .vg-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: rgba(0,0,0,0.35);
        color: var(--gold-light);
        box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        pointer-events: none; /* badges are indicators only; interactions via modal */
    }
    .vg-fav-badge { background: linear-gradient(90deg, rgba(255,215,0,0.12), rgba(255,215,0,0.06)); color: var(--gold); }
    .vg-emoji-badge { background: rgba(255,255,255,0.02); color: var(--gold-light); }

.voice-record-content {
    background: var(--deep-purple);
    border: 3px solid var(--gold);
    border-radius: 15px;
    padding: 2.5rem;
    max-width: 600px;
    width: 90%;
    position: relative;
}

.record-visualizer {
    width: 100%;
    height: 150px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    margin: 20px 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.record-timer {
    font-family: var(--font-display);
    font-size: 3rem;
    color: var(--gold);
    text-align: center;
    margin: 20px 0;
}

.record-controls {
    display: flex;
    justify-content: center;
    gap: 20px;
}

.record-btn {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: 3px solid var(--gold);
    background: rgba(255, 215, 0, 0.1);
    color: var(--gold);
    font-size: 2rem;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
}

.record-btn:hover {
    background: rgba(255, 215, 0, 0.3);
    transform: scale(1.1);
}

.record-btn.recording {
    background: rgba(220, 20, 60, 0.3);
    border-color: var(--crimson);
    color: var(--crimson);
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}


/* ===== ALTERNATE UNIVERSE STYLES ===== */
.universe-hub {
    text-align: center;
    margin-bottom: 3rem;
}

.universe-portal-viz {
    width: 300px;
    height: 300px;
    margin: 2rem auto;
    position: relative;
    background: radial-gradient(circle, rgba(138, 43, 226, 0.3), transparent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.central-nexus {
    font-size: 3rem;
    animation: spin 20s linear infinite;
}

.universe-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.universe-card {
    background: var(--highlight-glass);
    border: 2px solid var(--border-glass);
    border-radius: 12px;
    overflow: hidden;
    transition: var(--transition-fast);
    cursor: pointer;
}

.universe-card:hover {
    transform: translateY(-10px);
    border-color: var(--gold);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
}

.universe-header {
    padding: 1.5rem;
    background: linear-gradient(135deg, var(--deep-purple), rgba(74, 14, 78, 0.5));
}

.universe-icon {
    font-size: 3rem;
    margin-bottom: 10px;
}

.universe-title {
    font-family: var(--font-display);
    color: var(--gold);
    font-size: 1.6rem;
    margin-bottom: 5px;
}

.universe-era {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.universe-illustration {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-bottom: 2px solid var(--gold);
}

.universe-content {
    padding: 1.5rem;
}

.universe-premise {
    color: var(--text-primary);
    line-height: 1.7;
    margin-bottom: 1rem;
}

.universe-stats {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-glass);
}

.universe-actions {
    display: flex;
    gap: 10px;
    margin-top: 1rem;
}

/* Universe Reading View */
.universe-reading-view {
    max-width: 800px;
    margin: 0 auto;
}

.chapter-illustration {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 12px;
    border: 2px solid var(--gold);
    margin-bottom: 2rem;
}

.chapter-title {
    font-family: var(--font-display);
    font-size: 2.5rem;
    color: var(--gold);
    text-align: center;
    margin-bottom: 1rem;
}

.chapter-content {
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 12px;
    border-left: 4px solid var(--soft-violet);
}

.universe-reading-view .chapter-title {
    font-family: var(--font-display);
    font-size: 2.5rem;
    color: var(--gold);
    text-align: center;
    margin-bottom: 1rem;
}

.chapter-text {
    font-size: 1.15rem;
    line-height: 2;
    color: var(--text-primary);
    text-align: justify;
    font-family: var(--font-body);
}

.chapter-text p {
    margin-bottom: 1.5rem;
    text-indent: 2em;
}

.chapter-nav {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
}

.chapter-list-sidebar {
    position: sticky;
    top: 100px;
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    max-height: 400px;
    overflow-y: auto;
}

.chapter-list-item {
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: var(--transition-fast);
    margin-bottom: 5px;
}

.chapter-list-item:hover {
    background: rgba(255, 215, 0, 0.1);
}

.chapter-list-item.active {
    background: rgba(255, 215, 0, 0.2);
    border-left: 3px solid var(--gold);
}

/* Universe Writing Interface */
.writing-interface {
    max-width: 900px;
    margin: 0 auto;
}

.writing-toolbar {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.tool-btn {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid var(--soft-violet);
    border-radius: 6px;
    color: var(--gold-light);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.9rem;
}

.tool-btn:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: var(--gold);
}

.writing-editor {
    min-height: 500px;
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 8px;
    border: 1px solid var(--border-glass);
}

.word-count {
    text-align: right;
    color: var(--text-secondary);
    margin-top: 1rem;
    font-size: 0.9rem;
}

.collaborative-note {
    background: rgba(255, 215, 0, 0.1);
    padding: 1rem;
    border-radius: 8px;
    border-left: 3px solid var(--gold);
    margin-top: 1rem;
}


/* ===== MEMORY HEAT MAP STYLES ===== */
.heatmap-container {
    position: relative;
}

.map-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    justify-content: center;
}

.control-group {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.globe-container {
    width: 100%;
    height: 600px;
    background: radial-gradient(circle at center, #1a2a3a, #0a0f1e);
    border-radius: 15px;
    border: 2px solid var(--border-glass);
    position: relative;
    overflow: hidden;
}

.map-canvas {
    width: 100%;
    height: 100%;
}

.heat-legend {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(17, 12, 31, 0.9);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid var(--border-glass);
}

.legend-title {
    font-family: var(--font-display);
    color: var(--gold);
    margin-bottom: 10px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

.legend-color {
    width: 20px;
    height: 20px;
    border-radius: 4px;
}

.legend-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.map-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 2rem;
}

.map-stat-card {
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
}

.map-stat-icon {
    font-size: 2rem;
    margin-bottom: 10px;
}

.map-stat-value {
    font-size: 2rem;
    color: var(--gold);
    font-family: var(--font-display);
}

.map-stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 5px;
}

/* Location Detail Popup */
.location-detail-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--deep-purple);
    border: 3px solid var(--gold);
    border-radius: 15px;
    padding: 2rem;
    max-width: 700px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    z-index: 10001;
    display: none;
    box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
}

.location-detail-popup.active {
    display: block;
    animation: fade-in-up 0.5s;
}

.location-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 1.5rem;
}

.location-heat-indicator {
    font-size: 3rem;
}

.location-name {
    font-family: var(--font-display);
    font-size: 2rem;
    color: var(--gold);
}

.location-memory-count {
    color: var(--text-secondary);
}

.memory-breakdown {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin: 1.5rem 0;
}

.breakdown-item {
    background: rgba(0, 0, 0, 0.3);
    padding: 10px;
    border-radius: 6px;
}

.breakdown-label {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.breakdown-value {
    color: var(--gold);
    font-size: 1.5rem;
    font-family: var(--font-display);
}

.top-memories-list {
    margin-top: 2rem;
}

.memory-item {
    background: var(--highlight-glass);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    border-left: 3px solid var(--soft-violet);
    cursor: pointer;
    transition: var(--transition-fast);
}

.memory-item:hover {
    border-left-color: var(--gold);
    transform: translateX(5px);
}

.memory-date {
    color: var(--glow-cyan);
    font-size: 0.85rem;
}

.memory-title {
    color: var(--gold);
    font-size: 1.1rem;
    margin: 5px 0;
}

.memory-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.journey-path-line {
    stroke: var(--gold);
    stroke-width: 2;
    fill: none;
    stroke-dasharray: 5, 5;
    animation: dash 20s linear infinite;
}

@keyframes dash {
    to {
        stroke-dashoffset: -100;
    }
}


/* ===== RESPONSIVE ADJUSTMENTS ===== */
@media (max-width: 768px) {
    #mood-sync-content {
        padding: 0 10px;
    }

    .mood-center {
        flex-shrink: 1;
        min-width: 0;
    }

    .mood-label {
        display: none; /* Hide text labels on mobile to save space */
    }

    .current-mood-btn {
        padding: 6px 12px;
    }

    .mood-emoji { font-size: 1.2rem; }
    .mood-name { font-size: 0.8rem; }

    .combined-mood-display {
        font-size: 1rem;
        gap: 5px;
    }
    
    .capsule-orbit-view {
        height: 400px;
    }
    
    .recipe-grid {
        grid-template-columns: 1fr;
    }
    
    .universe-grid {
        grid-template-columns: 1fr;
    }
    
    .globe-container {
        height: 400px;
    }
    
    .memory-breakdown {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .mood-label {
        font-size: 0.8rem;
    }
    
    .current-mood-btn {
        padding: 6px 12px;
    }
    
    .mood-emoji {
        font-size: 1.2rem;
    }
    
    .combined-mood-display {
        font-size: 1rem;
    }
    
    .capsule-item {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
    }
    
    .voice-playback-modal {
        width: calc(100% - 40px);
        bottom: 10px;
        right: 10px;
    }
}

.option-btn.selected {
    background: rgba(255, 215, 0, 0.2);
    border-color: var(--gold);
    color: var(--gold);
}

.conditional-input {
    display: none;
    margin-top: 1rem;
}

.conditional-input.active {
    display: block;
}

.form-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
}

/* Unlock Animation */
.unlock-ceremony {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.95);
    z-index: 10002;
    display: none;
    align-items: center;
    justify-content: center;
}

.unlock-ceremony.active {
    display: flex;
}

.unlock-animation {
    text-align: center;
}

.unlock-capsule-icon {
    font-size: 8rem;
    animation: capsule-crack 2s ease-out;
}

@keyframes capsule-crack {
    0% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.2) rotate(10deg); }
    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
}

.unlock-countdown {
    font-family: var(--font-display);
    font-size: 4rem;
    color: var(--gold);
    text-shadow: 0 0 30px var(--gold);
    margin-top: 20px;
}


/* ===== RECIPE COSMOS STYLES ===== */
.recipe-cosmos-container {
    max-width: 1400px;
    margin: 0 auto;
}

.recipe-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    justify-content: center;
}

.recipe-filters {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 2rem;
    justify-content: center;
}

.filter-tag {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid var(--soft-violet);
    border-radius: 20px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.9rem;
}

.filter-tag:hover {
    border-color: var(--gold);
    color: var(--gold);
}

.filter-tag.active {
    background: rgba(255, 215, 0, 0.2);
    border-color: var(--gold);
    color: var(--gold);
}

.recipe-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.recipe-card {
    background: var(--highlight-glass);
    border: 1px solid var(--border-glass);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: var(--transition-fast);
}

.recipe-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border-color: var(--gold);
}

.recipe-card-image {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-bottom: 2px solid var(--gold);
}

.recipe-card-content {
    padding: 1.5rem;
}

.recipe-card-title {
    font-family: var(--font-display);
    color: var(--gold);
    font-size: 1.4rem;
    margin-bottom: 0.5rem;
}

.recipe-card-stats {
    display: flex;
    gap: 1rem;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
}

.recipe-rating {
    color: var(--gold);
}

/* Recipe Detail View */
.recipe-detail-view {
    max-width: 900px;
    margin: 0 auto;
}

.recipe-photo-gallery {
    position: relative;
    margin-bottom: 2rem;
}

.recipe-main-photo {
    width: 100%;
    height: 400px;
    object-fit: cover;
    border-radius: 12px;
    border: 2px solid var(--gold);
}

.recipe-thumbnails {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    overflow-x: auto;
    padding: 10px 0;
}

.recipe-thumbnail {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid var(--border-glass);
    cursor: pointer;
    transition: var(--transition-fast);
    flex-shrink: 0;
}

.recipe-thumbnail:hover, .recipe-thumbnail.active {
    border-color: var(--gold);
    transform: scale(1.1);
}

.recipe-story {
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid var(--gold);
    margin-bottom: 2rem;
}

.recipe-story h3 {
    font-family: var(--font-display);
    color: var(--gold);
    margin-bottom: 1rem;
}

.recipe-meta {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.meta-item {
    text-align: center;
    padding: 1rem;
    background: var(--highlight-glass);
    border-radius: 8px;
}

.meta-label {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.meta-value {
    color: var(--gold);
    font-size: 1.3rem;
    font-family: var(--font-display);
}

.recipe-ingredients {
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
}

.recipe-ingredients h3 {
    font-family: var(--font-display);
    color: var(--gold);
    margin-bottom: 1rem;
}

.ingredient-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    border-bottom: 1px solid var(--border-glass);
}

.ingredient-item:last-child {
    border-bottom: none;
}

.ingredient-checkbox {
    width: 20px;
    height: 20px;
}

.ingredient-photo-thumb {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border-radius: 4px;
}

.recipe-instructions {
    margin-bottom: 2rem;
}

.instruction-step {
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    border-left: 4px solid var(--soft-violet);
}

.step-number {
    font-family: var(--font-display);
    font-size: 2rem;
    color: var(--gold);
    margin-bottom: 0.5rem;
}

.step-photo {
    width: 100%;
    max-width: 400px;
    height: auto;
    border-radius: 8px;
    margin: 1rem 0;
}

.step-timer-btn {
    margin-top: 0.5rem;
}

.step-tip {
    background: rgba(255, 215, 0, 0.1);
    padding: 10px;
    border-radius: 6px;
    border-left: 3px solid var(--gold);
    margin-top: 1rem;
    font-style: italic;
}

.recipe-rating-section {
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 12px;
    border: 2px solid var(--gold);
    margin-bottom: 2rem;
}

.rating-stars {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.rating-category {
    flex: 1;
}

.rating-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 5px;
}

.stars {
    color: var(--gold);
    font-size: 1.5rem;
}

.nic-review {
    background: rgba(255, 215, 0, 0.1);
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid var(--gold);
}

.review-text {
    font-style: italic;
    color: var(--gold-light);
    line-height: 1.8;
    margin-bottom: 1rem;
}

.review-author {
    color: var(--text-secondary);
    text-align: right;
}


/* ===== VOICE GARDEN STYLES ===== */
.voice-garden-container {
    position: relative;
    min-height: 600px;
}

.garden-stats-bar {
    display: flex;
    justify-content: space-around;
    padding: 1rem;
    background: var(--highlight-glass);
    border-radius: 8px;
    margin-bottom: 2rem;
}

.garden-stat {
    text-align: center;
}

.stat-value {
    font-size: 1.8rem;
    color: var(--gold);
    font-family: var(--font-display);
}

.stat-desc {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

/* ===== VOICE GARDEN STYLES ===== */
.voice-garden-container {
    position: relative;
    min-height: 600px;
}

.garden-stats-bar {
    display: flex;
    justify-content: space-around;
    padding: 1rem;
    background: var(--highlight-glass);
    border-radius: 8px;
    margin-bottom: 2rem;
}

.garden-stat {
    text-align: center;
}


.garden-view {
    position: relative;
    min-height: 500px;
    background: linear-gradient(to bottom, #0a0f1e 0%, #1a2a3a 100%);
    border-radius: 15px;
    border: 2px solid var(--border-glass);
    padding: 2rem;
    overflow: hidden;
}

.garden-ground {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 100px;
    background: linear-gradient(to top, #2d1810, transparent);
}

.garden-flower {
    position: absolute;
    cursor: pointer;
    transition: var(--transition-fast);
    animation: float 4s ease-in-out infinite;
}

.garden-flower:hover {
    transform: scale(1.3);
    z-index: 10;
}

.flower-icon {
    font-size: 3rem;
    filter: drop-shadow(0 0 10px currentColor);
}

.flower-stem {
    width: 4px;
    height: 40px;
    background: #2d5016;
    margin: 0 auto;
}

.flower-unheard {
    animation: pulse-glow 2s infinite, float 4s ease-in-out infinite;
}

.playback-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.playback-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition-fast);
}
.playback-close:hover {
    color: var(--gold);
    transform: rotate(90deg);
}

.waveform-container {
    height: 80px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.waveform-bar {
    width: 3px;
    background: var(--gold);
    margin: 0 2px;
    border-radius: 2px;
    transition: height 0.1s;
}

.playback-progress {
    width: 100%;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    margin-bottom: 10px;
    cursor: pointer;
    position: relative;
}

.playback-progress-fill {
    height: 100%;
    background: var(--gold);
    border-radius: 3px;
    width: 0%;
    transition: width 0.1s;
}

.playback-time {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-bottom: 15px;
}

.playback-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
}

.playback-btn {
    background: none;
    border: none;
    color: var(--gold);
    font-size: 1.8rem;
    cursor: pointer;
    transition: var(--transition-fast);
}

.playback-btn:hover {
    color: var(--gold-light);
    transform: scale(1.1);
}

.playback-metadata {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border-glass);
}

.metadata-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.metadata-label {
    color: var(--text-secondary);
}

.metadata-value {
    color: var(--gold-light);
}

.voice-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.voice-action-btn {
    flex: 1;
    padding: 10px;
    background: transparent;
    border: 1px solid var(--soft-violet);
    border-radius: 6px;
    color: var(--gold-light);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.9rem;
}

.voice-action-btn:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: var(--gold);
}

.playback-transcript-container {
    margin-top: 15px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    border-top: 1px solid var(--border-glass);
    max-height: 150px;
    overflow-y: auto;
}

.transcript-title {
    font-family: var(--font-display);
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

#playback-transcript-text {
    color: var(--text-primary);
    line-height: 1.7;
    font-size: 0.95rem;
}

/* Recording Modal */
.voice-record-modal {
    position: fixed;
    inset: 0;
    background: rgba(2, 4, 27, 0.9);
    backdrop-filter: blur(10px);
    z-index: 10001;
    display: none;
    align-items: center;
    justify-content: center;
}

.voice-record-modal.active {
    display: flex;
}

.voice-record-content {
    background: var(--deep-purple);
    border: 3px solid var(--gold);
    border-radius: 15px;
    padding: 2.5rem;
    max-width: 600px;
    width: 90%;
    position: relative;
}

/* Recording Modal */
.voice-record-modal {
    position: fixed;
    inset: 0;
    background: rgba(2, 4, 27, 0.9);
    backdrop-filter: blur(10px);
    z-index: 10001;
    display: none;
    align-items: center;
    justify-content: center;
}

.voice-record-modal.active {
    display: flex;
}



.record-visualizer {
    width: 100%;
    height: 150px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    margin: 20px 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.record-timer {
    font-family: var(--font-display);
    font-size: 3rem;
    color: var(--gold);
    text-align: center;
    margin: 20px 0;
}

.record-controls {
    display: flex;
    justify-content: center;
    gap: 20px;
}

.record-btn {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: 3px solid var(--gold);
    background: rgba(255, 215, 0, 0.1);
    color: var(--gold);
    font-size: 2rem;
    cursor: pointer;
    transition: var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
}

.record-btn:hover {
    background: rgba(255, 215, 0, 0.3);
    transform: scale(1.1);
}

.record-btn.recording {
    background: rgba(220, 20, 60, 0.3);
    border-color: var(--crimson);
    color: var(--crimson);
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}


/* ===== ALTERNATE UNIVERSE STYLES ===== */
.universe-hub {
    text-align: center;
    margin-bottom: 3rem;
}

.universe-portal-viz {
    width: 300px;
    height: 300px;
    margin: 2rem auto;
    position: relative;
    background: radial-gradient(circle, rgba(138, 43, 226, 0.3), transparent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.central-nexus {
    font-size: 3rem;
    animation: spin 20s linear infinite;
}

.universe-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.universe-card {
    background: var(--highlight-glass);
    border: 2px solid var(--border-glass);
    border-radius: 12px;
    overflow: hidden;
    transition: var(--transition-fast);
    cursor: pointer;
}

.universe-card:hover {
    transform: translateY(-10px);
    border-color: var(--gold);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
}

.universe-header {
    padding: 1.5rem;
    background: linear-gradient(135deg, var(--deep-purple), rgba(74, 14, 78, 0.5));
}

.universe-icon {
    font-size: 3rem;
    margin-bottom: 10px;
}

.universe-title {
    font-family: var(--font-display);
    color: var(--gold);
    font-size: 1.6rem;
    margin-bottom: 5px;
}

.universe-era {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.universe-illustration {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-bottom: 2px solid var(--gold);
}

.universe-content {
    padding: 1.5rem;
}

.universe-premise {
    color: var(--text-primary);
    line-height: 1.7;
    margin-bottom: 1rem;
}

.universe-stats {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-glass);
}

.universe-actions {
    display: flex;
    gap: 10px;
    margin-top: 1rem;
}

/* Universe Reading View */
.universe-reading-view {
    max-width: 800px;
    margin: 0 auto;
}

.chapter-illustration {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 12px;
    border: 2px solid var(--gold);
    margin-bottom: 2rem;
}

.chapter-title {
    font-family: var(--font-display);
    font-size: 2.5rem;
    color: var(--gold);
    text-align: center;
    margin-bottom: 1rem;
}

.chapter-content {
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 12px;
    border-left: 4px solid var(--soft-violet);
}

.chapter-text {
    font-size: 1.15rem;
    line-height: 2;
    color: var(--text-primary);
    text-align: justify;
    font-family: var(--font-body);
}

.chapter-text p {
    margin-bottom: 1.5rem;
    text-indent: 2em;
}

.chapter-nav {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
}

.chapter-list-sidebar {
    position: sticky;
    top: 100px;
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    max-height: 400px;
    overflow-y: auto;
}

.chapter-list-item {
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: var(--transition-fast);
    margin-bottom: 5px;
}

.chapter-list-item:hover {
    background: rgba(255, 215, 0, 0.1);
}

.chapter-list-item.active {
    background: rgba(255, 215, 0, 0.2);
    border-left: 3px solid var(--gold);
}

/* Universe Writing Interface */
.writing-interface {
    max-width: 900px;
    margin: 0 auto;
}

.writing-toolbar {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.tool-btn {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid var(--soft-violet);
    border-radius: 6px;
    color: var(--gold-light);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.9rem;
}

.tool-btn:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: var(--gold);
}

.writing-editor {
    min-height: 500px;
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 8px;
    border: 1px solid var(--border-glass);
}

.word-count {
    text-align: right;
    color: var(--text-secondary);
    margin-top: 1rem;
    font-size: 0.9rem;
}

.collaborative-note {
    background: rgba(255, 215, 0, 0.1);
    padding: 1rem;
    border-radius: 8px;
    border-left: 3px solid var(--gold);
    margin-top: 1rem;
}


/* ===== MATH CALCULATOR STYLES ===== */
.math-calculator-container {
    background: linear-gradient(135deg, #1e3a1e 0%, #0d1f0d 100%);
    padding: 2rem;
    border-radius: 15px;
    border: 3px solid var(--gold);
    margin: 2rem 0;
}

.chalkboard {
    background: #1e3a1e;
    padding: 2rem;
    border-radius: 8px;
    border: 2px solid #4a5a4a;
    margin-bottom: 2rem;
    font-family: 'Times New Roman', serif;
}

.equation-title {
    text-align: center;
    color: var(--gold);
    font-size: 1.2rem;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.equation-display {
    text-align: center;
    font-size: 2.5rem;
    color: #FFFFFF;
    margin: 2rem 0;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.equation-legend {
    color: #CCCCCC;
    line-height: 1.8;
    padding-left: 2rem;
}

.equation-legend li {
    margin-bottom: 8px;
}

.current-value {
    text-align: center;
    font-size: 2rem;
    color: var(--gold);
    margin-top: 1rem;
    font-family: var(--font-display);
}

.compatibility-section {
    margin: 3rem 0;
}

.overall-score {
    text-align: center;
    padding: 2rem;
    background: var(--highlight-glass);
    border-radius: 12px;
    border: 3px solid var(--gold);
    margin-bottom: 2rem;
}

.score-number {
    font-size: 5rem;
    color: var(--gold);
    font-family: var(--font-display);
    text-shadow: 0 0 30px var(--gold);
}

.score-label {
    font-size: 1.5rem;
    color: var(--gold-light);
    margin-top: 10px;
    font-family: var(--font-handwriting);
}

.compatibility-breakdown {
    display: grid;
    gap: 1.5rem;
}

.compat-category {
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid var(--soft-violet);
}

.category-name {
    font-size: 1.2rem;
    color: var(--gold);
    margin-bottom: 10px;
}

.category-bar {
    width: 100%;
    height: 12px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 10px;
}

.category-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--soft-violet), var(--glow-cyan));
    transition: width 1s ease;
}

.category-explanation {
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.6;
}

.math-formula {
    background: rgba(0, 0, 0, 0.3);
    padding: 10px;
    border-radius: 6px;
    margin-top: 10px;
    font-family: 'Courier New', monospace;
    color: var(--glow-cyan);
}

.theorem-section {
    margin: 3rem 0;
}

.theorem-card {
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 12px;
    border: 2px solid var(--border-glass);
    margin-bottom: 2rem;
}

.theorem-title {
    font-family: var(--font-display);
    font-size: 1.8rem;
    color: var(--gold);
    margin-bottom: 1rem;
}

.theorem-statement {
    color: var(--text-primary);
    font-size: 1.1rem;
    line-height: 1.7;
    margin-bottom: 1rem;
}

.theorem-proof {
    background: rgba(0, 0, 0, 0.3);
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid var(--jade);
}

.proof-label {
    color: var(--jade);
    font-weight: bold;
    margin-bottom: 10px;
}

.qed {
    text-align: right;
    color: var(--gold);
    font-size: 1.2rem;
    margin-top: 10px;
}

.graph-container {
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 12px;
    margin: 2rem 0;
}

.graph-canvas {
    width: 100%;
    height: 400px;
    background: #FFFFFF;
    border-radius: 8px;
}


/* ===== ALTERNATE UNIVERSE STYLES ===== */
.universe-hub {
    text-align: center;
    margin-bottom: 3rem;
}

.universe-portal-viz {
    width: 300px;
    height: 300px;
    margin: 2rem auto;
    position: relative;
    background: radial-gradient(circle, rgba(138, 43, 226, 0.3), transparent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.central-nexus {
    font-size: 3rem;
    animation: spin 20s linear infinite;
}
/* --- OBSERVATORY STYLES (INTEGRATED) --- */
#tab-observatory {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    perspective: 1500px; /* Added for 3D transforms */
}

#canvas-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    cursor: grab;
}

/* When the observatory is active, force its containers to be full-screen. */
.main-content.observatory-active,
.main-content.observatory-active #guide-panel,
.main-content.observatory-active #guide-main-container,
.main-content.observatory-active #guide-sections-view {
    padding: 0 !important;
    max-width: 100% !important;
    height: 100% !important;
}

/* Telescope Frame - Top Right */
#telescope-frame {
    position: fixed;
    top: 20px;
    right: 30px;
    width: 200px; /* Made smaller */
    height: 200px; /* Made smaller */
    z-index: 10;
    filter: drop-shadow(0 0 15px var(--soft-violet)); /* Changed from filter */
    pointer-events: all; /* Make it clickable */
    cursor: pointer; /* Show pointer on hover */
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.4s ease;
    
    /* 3D Frame Styles */
    transform: rotateX(5deg); /* Changed for 'well-oriented' 3D look */
    border: 8px solid var(--deep-purple);
    /* box-shadow: 0 10px 30px var(--shadow-color), inset 0 0 10px var(--shadow-color); */ /* Removed shadow */
    background: var(--space-black);
    border-radius: 10px;
}

#telescope-frame:hover {
    transform: scale(1.05) rotateX(0deg); /* Flattens on hover */
}

#telescope-image {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Ensure the image scales correctly */
    border-radius: 2px;
    box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
}

/* Memory Markers in 3D Space */
.memory-marker {
    position: absolute;
    width: 24px;
    height: 24px;
    z-index: 5;
    pointer-events: all;
    cursor: pointer;
    transform: translate(-50%, -50%);
    transition: transform 0.3s;
}

.memory-marker:hover {
    transform: translate(-50%, -50%) scale(1.3);
}

.memory-ring {
    position: absolute;
    width: 100%;
    height: 100%;
    border: 2px solid var(--gold);
    border-radius: 50%;
    animation: ringPulse 2s ease-in-out infinite;
}

.memory-ring::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 10px;
    height: 10px;
    background: var(--gold);
    border-radius: 50%;
    box-shadow: 0 0 20px var(--gold);
}

@keyframes ringPulse {
    0%, 100% { transform: scale(1); opacity: 0.8; }
    50% { transform: scale(1.5); opacity: 1; }
}

.memory-label {
    position: absolute;
    top: -45px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--holoscreen-bg);
    color: var(--gold);
    padding: 6px 14px;
    border-radius: 6px;
    font-size: 11px;
    white-space: nowrap;
    border: 1px solid var(--border-glass);
    font-family: 'Cinzel', serif;
    letter-spacing: 1px;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
    z-index: 100;
}

.memory-marker:hover .memory-label {
    opacity: 1;
}

/* Controls */
#controls {
    position: fixed;
    top: 20px;
    right: 30px; /* Moved to top-right */
    background: var(--holoscreen-bg);
    border: 2px solid var(--border-glass);
    border-radius: 15px;
    padding: 20px;
    z-index: 11; /* Changed to be ON TOP of telescope */
    backdrop-filter: blur(10px);
    box-shadow: 0 0 30px var(--border-glass);
    width: 220px; /* Set fixed width */
    
    /* 3D Card & Hidden State */
    opacity: 0;
    visibility: hidden;
    transform: rotateY(-30deg) scale(0.9);
    transform-origin: top right; /* Changed transform origin */
    transition: all 0.4s ease-out;
}

#controls.visible {
    opacity: 1;
    visibility: visible;
    transform: rotateY(0deg) scale(1);
    /* REMOVED right: 240px; to make it appear on top of telescope */
}


/* --- ADDED: Full Observatory Control Styling --- */
#controls h3 {
    margin: 0 0 15px 0;
    font-size: 16px;
    color: var(--glow-cyan);
    font-weight: 700;
    letter-spacing: 2px;
    text-align: center;
}

.control-section {
    margin-bottom: 15px;
}

.control-label {
    display: block;
    color: var(--text-secondary);
    font-size: 11px;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.control-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 12px;
}

.control-btn {
    background: var(--highlight-glass);
    border: 1px solid var(--border-glass);
    color: var(--glow-cyan);
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.control-btn:hover {
    background: var(--highlight-glass);
    box-shadow: 0 0 15px var(--glow-cyan);
    color: var(--gold-light);
    transform: scale(1.05);
}

.control-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    background: rgba(0,0,0,0.1);
    border-color: rgba(255,255,255,0.1);
}

input[type="range"] {
    width: 100%;
    margin-top: 5px;
}

.hud-info {
    color: var(--text-secondary);
    font-size: 11px;
    line-height: 1.8;
}

.hud-info div {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    border-bottom: 1px solid var(--border-glass);
}

.hud-label {
    color: var(--text-secondary);
}

.hud-value {
    color: var(--glow-cyan);
    font-weight: 600;
}

/* Story Modal */
#story-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 90%;
    max-width: 700px;
    max-height: 85vh;
    background: var(--space-black);
    border: 3px solid var(--gold);
    border-radius: 20px;
    padding: 50px;
    z-index: 1000;
    overflow-y: auto;
    box-shadow: 0 0 80px var(--gold);
    transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

#story-modal.active {
    transform: translate(-50%, -50%) scale(1);
}

#story-modal h2 {
    color: var(--gold);
    font-family: 'Cinzel', serif;
    font-size: 28px;
    margin-bottom: 10px;
    text-align: center;
    text-shadow: 0 0 20px var(--gold);
}

.story-date {
    color: var(--glow-cyan);
    font-size: 13px;
    text-align: center;
    margin-bottom: 25px;
    font-style: italic;
    letter-spacing: 2px;
}

.story-content {
    color: var(--text-primary);
    line-height: 1.9;
    font-size: 15px;
    text-align: justify;
    font-family: 'Georgia', serif;
}

.close-btn {
    position: absolute;
    top: 15px;
    right: 20px;
    background: none;
    border: none;
    color: var(--gold);
    font-size: 32px;
    cursor: pointer;
    transition: transform 0.3s, color 0.3s;
    font-weight: 300;
}

.close-btn:hover {
    transform: rotate(90deg);
    color: var(--gold-light);
}

#loading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--space-black);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    transition: opacity 0.5s;
}

#loading.hidden {
    opacity: 0;
    pointer-events: none;
}

.loader {
    color: var(--text-secondary);
    font-size: 18px;
    font-family: 'Cinzel', serif;
    letter-spacing: 3px;
    text-align: center;
}

/* Made selector more specific */
#tab-observatory .back-button {
    position: fixed;
    top: 235px; /* Positioned below telescope (20px top + 200px height + 15px margin) */
    left: auto; /* Remove left positioning */
    right: 30px; /* Align with telescope's right edge */
    transform: none; /* Removed translateX */
    bottom: auto; /* Removed bottom positioning */
    z-index: 10;
    padding: 14px 24px;
    font-size: 1rem;
    font-weight: 500;
    border: 2px solid var(--gold);
    border-radius: 8px;
    background: var(--holoscreen-bg);
    color: var(--gold);
    cursor: pointer;
    transition: all 0.3s;
    font-family: 'Orbitron', sans-serif;
    box-shadow: 0 0 15px var(--gold);
    backdrop-filter: blur(10px);
}

/* Made selector more specific */
#tab-observatory .back-button:hover {
    background: var(--highlight-glass);
    box-shadow: 0 0 25px var(--gold);
    transform: translateY(-2px); /* Removed translateX */
}

@media (max-width: 768px) {
    #controls {
        width: 180px;
        max-width: calc(100% - 20px);
        left: auto; /* Removed 50% */
        top: 10px; /* Align with telescope */
        right: 10px; /* Align with telescope */
        transform: rotateY(-30deg) scale(0.9); /* Use 3D transform */
        transform-origin: top right; /* Set origin */
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s ease-out;
    }

    #controls.visible {
        transform: rotateY(0deg) scale(1); /* Animate in */
        opacity: 1;
        visibility: visible;
        right: 10px;
    }
    
    #telescope-frame {
        display: flex; /* Changed from none */
        width: 100px; /* Smaller for mobile */
        height: 100px;
        top: 10px;
        right: 10px;
        /* 3D Frame Styles for Mobile */
        transform: none; /* Changed for 'well-oriented' 3D look */
        border: 6px solid var(--deep-purple);
        /* box-shadow: 0 5px 20px var(--shadow-color), inset 0 0 8px var(--shadow-color); */ /* Removed shadow */
        background: var(--space-black);
        border-radius: 8px;
    }
    
    #story-modal {
        padding: 35px 25px;
    }

    /* Made selector more specific */
    #tab-observatory .back-button {
        bbottom: auto; /* Removed bottom positioning */
        left: auto; /* Remove left positioning */
        right: 10px; /* Align with telescope's right edge */
        top: 120px; /* Position below telescope (10px top + 100px height + 10px margin) */
        transform: none; /* Removed transform */
        padding: 6px 1px;
        font-size: 0.6rem;
    }
}



/* --- ADD THIS --- */
#portal-particles {
    position: absolute;
    inset: 0;
}

.universe-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.universe-card {
    background: var(--highlight-glass);
    border: 2px solid var(--border-glass);
    border-radius: 12px;
    overflow: hidden;
    transition: var(--transition-fast);
    cursor: pointer;
}

.universe-card:hover {
    transform: translateY(-10px);
    border-color: var(--gold);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
}

.universe-header {
    padding: 1.5rem;
    background: linear-gradient(135deg, var(--deep-purple), rgba(74, 14, 78, 0.5));
    position: relative; /* For positioning edit/delete buttons */

}

.universe-icon {
    font-size: 3rem;
    margin-bottom: 10px;
}

.universe-title {
    font-family: var(--font-display);
    color: var(--gold);
    font-size: 1.6rem;
    margin-bottom: 5px;
}

.universe-era {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.universe-illustration {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-bottom: 2px solid var(--gold);
}

.universe-content {
    padding: 1.5rem;
}

.universe-premise {
    color: var(--text-primary);
    line-height: 1.7;
    margin-bottom: 1rem;
}

.universe-stats {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-glass);
}

.universe-actions {
    display: flex;
    gap: 10px;
    margin-top: 1rem;
}

/* --- ADD THIS --- */
.universe-card-controls {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 5px;
    background: rgba(0,0,0,0.3);
    padding: 5px;
    border-radius: 5px;
    opacity: 0;
    transition: var(--transition-fast);
}

.universe-card:hover .universe-card-controls {
    opacity: 1;
}

/* Universe Reading View */
.universe-reading-view {
    max-width: 800px;
    margin: 0 auto;
}

.chapter-illustration {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 12px;
    border: 2px solid var(--gold);
    margin-bottom: 2rem;
}

.chapter-title {
    font-family: var(--font-display);
    font-size: 2.5rem;
    color: var(--gold);
    text-align: center;
    margin-bottom: 1rem;
}

.chapter-content {
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 12px;
    border-left: 4px solid var(--soft-violet);
}

.chapter-text {
    font-size: 1.15rem;
    line-height: 2;
    color: var(--text-primary);
    text-align: justify;
    font-family: var(--font-body);
}

.chapter-text p {
    margin-bottom: 1.5rem;
    text-indent: 2em;
}

.chapter-nav {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
}

.chapter-list-sidebar {
    position: sticky;
    top: 100px;
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    max-height: 400px;
    overflow-y: auto;
}

.chapter-list-item {
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: var(--transition-fast);
    margin-bottom: 5px;
}

.chapter-list-item:hover {
    background: rgba(255, 215, 0, 0.1);
}

.chapter-list-item.active {
    background: rgba(255, 215, 0, 0.2);
    border-left: 3px solid var(--gold);
}

/* Universe Writing Interface */
.writing-interface {
    max-width: 900px;
    margin: 0 auto;
}

.writing-toolbar {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.tool-btn {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid var(--soft-violet);
    border-radius: 6px;
    color: var(--gold-light);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: 0.9rem;
}

.tool-btn:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: var(--gold);
}

.writing-editor {
    min-height: 500px;
    background: var(--highlight-glass);
    padding: 2rem;
    border-radius: 8px;
    border: 1px solid var(--border-glass);
}

.word-count {
    text-align: right;
    color: var(--text-secondary);
    margin-top: 1rem;
    font-size: 0.9rem;
}

/* --- FIX: Improve mobile layout for universe reading view --- */
@media (max-width: 768px) {
    .universe-reading-view .universe-characters {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}

.collaborative-note {
    background: rgba(255, 215, 0, 0.1);
    padding: 1rem;
    border-radius: 8px;
    border-left: 3px solid var(--gold);
    margin-top: 1rem;
}


/* ===== MEMORY HEAT MAP STYLES ===== */
.heatmap-container {
    position: relative;
}

.map-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    justify-content: center;
}

.control-group {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.globe-container {
    width: 100%;
    height: 600px;
    background: radial-gradient(circle at center, #1a2a3a, #0a0f1e);
    border-radius: 15px;
    border: 2px solid var(--border-glass);
    position: relative;
    overflow: hidden;
}

.map-canvas {
    width: 100%;
    height: 100%;
}

.heat-legend {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(17, 12, 31, 0.9);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid var(--border-glass);
}

.legend-title {
    font-family: var(--font-display);
    color: var(--gold);
    margin-bottom: 10px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

.legend-color {
    width: 20px;
    height: 20px;
    border-radius: 4px;
}

.legend-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.map-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 2rem;
}

.map-stat-card {
    background: var(--highlight-glass);
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
}

.map-stat-icon {
    font-size: 2rem;
    margin-bottom: 10px;
}

.map-stat-value {
    font-size: 2rem;
    color: var(--gold);
    font-family: var(--font-display);
}

.map-stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-top: 5px;
}

/* Location Detail Popup */
.location-detail-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--deep-purple);
    border: 3px solid var(--gold);
    border-radius: 15px;
    padding: 2rem;
    max-width: 700px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    z-index: 10001;
    display: none;
    box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
}

.location-detail-popup.active {
    display: block;
    animation: fade-in-up 0.5s;
}

.location-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 1.5rem;
}

.location-heat-indicator {
    font-size: 3rem;
}

.location-name {
    font-family: var(--font-display);
    font-size: 2rem;
    color: var(--gold);
}

.location-memory-count {
    color: var(--text-secondary);
}

.memory-breakdown {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin: 1.5rem 0;
}

.breakdown-item {
    background: rgba(0, 0, 0, 0.3);
    padding: 10px;
    border-radius: 6px;
}

.breakdown-label {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.breakdown-value {
    color: var(--gold);
    font-size: 1.5rem;
    font-family: var(--font-display);
}

.top-memories-list {
    margin-top: 2rem;
}

.memory-item {
    background: var(--highlight-glass);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    border-left: 3px solid var(--soft-violet);
    cursor: pointer;
    transition: var(--transition-fast);
}

.memory-item:hover {
    border-left-color: var(--gold);
    transform: translateX(5px);
}

.memory-date {
    color: var(--glow-cyan);
    font-size: 0.85rem;
}

.memory-title {
    color: var(--gold);
    font-size: 1.1rem;
    margin: 5px 0;
}

.memory-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.journey-path-line {
    stroke: var(--gold);
    stroke-width: 2;
    fill: none;
    stroke-dasharray: 5, 5;
    animation: dash 20s linear infinite;
}

@keyframes dash {
    to {
        stroke-dashoffset: -100;
    }
}


@media (max-width: 480px) {
    .mood-label {
        font-size: 0.8rem;
    }
    
    .current-mood-btn {
        padding: 6px 12px;
    }
    
    .mood-emoji {
        font-size: 1.2rem;
    }
    
    .combined-mood-display {
        font-size: 1rem;
    }
    
    .capsule-item {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
    }
    
    .voice-playback-modal {
        width: calc(100% - 40px);
        bottom: 10px;
        right: 10px;
    }
}
